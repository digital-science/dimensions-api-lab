{
 "cells": [
  {
   "cell_type": "markdown",
   "metadata": {
    "Collapsed": "false",
    "id": "JIStGO6ErhR1"
   },
   "source": [
    "# Identification of reviewers for funders: Globally and among Panels\n",
    "\n",
    "This notebook shows to use the [expert identification](https://docs.dimensions.ai/dsl/expert-identification.html) workflow available via Dimensions Analytics API, with a focus on the use case of funders identifying reviewers.\n",
    "\n",
    "For more general expert identification using the Dimensions Analytics API, see **[Expert Identification with the Dimensions API - An Introduction](https://api-lab.dimensions.ai/cookbooks/7-researchers/Experts-search-introduction.html)**.\n"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 1,
   "metadata": {},
   "outputs": [
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "==\n",
      "CHANGELOG\n",
      "This notebook was last run on Jan 25, 2022\n",
      "==\n"
     ]
    }
   ],
   "source": [
    "import datetime\n",
    "print(\"==\\nCHANGELOG\\nThis notebook was last run on %s\\n==\" % datetime.date.today().strftime('%b %d, %Y'))"
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {
    "Collapsed": "false",
    "id": "otNCm2eAtAy0"
   },
   "source": [
    "## Introduction: Use Cases For Reviewer Identification\n"
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {
    "Collapsed": "false",
    "id": "hzdwAWPp_9L2"
   },
   "source": [
    "A very common workflow for research funders is to solicit grant applications, then to have members of the research community critique and score those applications to determine what is ultimately funded. \n",
    "\n",
    "A challenge for this workflow revolves around finding and assigning the appropriate reviewers to each application. This task is most often handled by relying on past experience and insider knowledge of a specific research area. This approach is not always reliable, is difficult to impart when program staff changes, and risks forming an insular subset of the research community. \n",
    "\n",
    "To aid in this problem, Dimensions has developed a suite of tools to help identify researchers for scientific research proposals. These include a GUI available inside the [Dimensions app](https://www.digital-science.com/blog/events/webinar-finding-reviewers-dimensions/), <!--- not sure about that link --> as well a programmatic approach using the [Dimensions Analytics API](https://www.dimensions.ai/dimensions-apis/) which will be described here.\n",
    "\n",
    "---\n",
    "The overall workflow to identify reviewers is described in **[Expert Identification with the Dimensions API - An Introduction](https://api-lab.dimensions.ai/cookbooks/7-researchers/Experts-search-introduction.html)**, and is discussed in more detail there. At its core, the process has two steps:\n",
    "1. Use Dimensions Analytics API to extract key concepts from grant application text\n",
    "2. Use those concepts to search in the Dimensions Analytics API for relevant researchers\n",
    "\n",
    "These two steps will be performed and only commented on lightly in this notebook. For more details, see the example linked above."
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {
    "Collapsed": "false",
    "id": "3XprU3Qvxn5l"
   },
   "source": [
    "### Kinds of identification\n",
    "\n",
    "There are two \"kinds\" of reviewer identification that can be performed. These are:\n",
    "1. **GLOBAL IDENTIFICATION** - Where reviewers are identified from the body of all researchers - for example, find the best reviewers for an application worldwide, or from a specific country\n",
    "\n",
    "  **Example 1:** A funder is trying to find reviewers for a set of applications, but only wishes to use people they have already funded (e.g. people they already know, and do not need to worry about vetting). In that case, the body of researchers they are looking for is *all researchers who have been funded by them in the past*.\n",
    "\n",
    "  **Example 2:** A funder is working in partnership with a collection of universities to perform a body of research. As part of that partnership, personnel from these universities will review grant applications. In that case, the body of researchs they are looking for is *all researchers currently affiliated with any of a list of universities.*\n",
    "\n",
    "\n",
    "2. **PANEL IDENTIFICATION** - Where reviewers are identified from a list of known researchers - for example, find the best reviewers for an application from a panel of reviewers\n",
    "\n",
    "  **Example:** A funder has a pre-assembled body of a dozen researchers which it intends to use to review a body of a dozen applications, each of which needs three reviewers. A total of 12 x 12 x 3 = *432 assignments* need to be made. These assignments should align application topic and reviewer expertise. This is a very arduous task for a human looking at blocks of text (e.g. application abstract vs. reviewer CV) for 144 possible combinations.\n",
    "\n",
    "Each of these will be described in subsections below.\n",
    "\n",
    "**NOTE** In neither of these scenarios is this utility meant to supplant the need for human work and produce a fully automated workflow. Instead, this approach is meant to assist human selection of reviewers, reducing workload by narrowing to a subset of relevant reviews. Final selections can then be made by program staff."
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {
    "Collapsed": "false",
    "id": "2fXsRup1smxh"
   },
   "source": [
    "\n",
    "## Prerequisites\n",
    "\n",
    "This notebook assumes you have installed the [Dimcli](https://pypi.org/project/dimcli/) library and are familiar with the ['Getting Started' tutorial](https://api-lab.dimensions.ai/cookbooks/1-getting-started/1-Using-the-Dimcli-library-to-query-the-API.html).\n",
    "\n",
    "To generate an API key from the Dimensions webapp, go to \"My Account\". Under \"General Settings\" there is an \"API key\" section where there is a \"Create API key\" button. More information on this can be found [here](https://dimensions.freshdesk.com/support/solutions/articles/23000018791)."
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 2,
   "metadata": {
    "Collapsed": "false",
    "colab": {
     "base_uri": "https://localhost:8080/"
    },
    "executionInfo": {
     "elapsed": 85834,
     "status": "ok",
     "timestamp": 1623437109046,
     "user": {
      "displayName": "Derek Denning",
      "photoUrl": "",
      "userId": "01288319615638558065"
     },
     "user_tz": 240
    },
    "id": "5eRp0a0drSc7",
    "outputId": "049f5d16-cf20-4797-f58a-44ff5a96506b"
   },
   "outputs": [
    {
     "name": "stderr",
     "output_type": "stream",
     "text": [
      "\u001b[2mSearching config file credentials for 'https://app.dimensions.ai' endpoint..\u001b[0m\n"
     ]
    },
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "==\n",
      "Logging in..\n",
      "\u001b[2mDimcli - Dimensions API Client (v0.9.6)\u001b[0m\n",
      "\u001b[2mConnected to: <https://app.dimensions.ai/api/dsl> - DSL v2.0\u001b[0m\n",
      "\u001b[2mMethod: dsl.ini file\u001b[0m\n"
     ]
    }
   ],
   "source": [
    "!pip install dimcli -U --quiet \n",
    "\n",
    "import dimcli\n",
    "from dimcli.utils import *\n",
    "\n",
    "import sys, json, time, os\n",
    "import pandas as pd\n",
    "\n",
    "print(\"==\\nLogging in..\")\n",
    "# https://digital-science.github.io/dimcli/getting-started.html#authentication\n",
    "ENDPOINT = \"https://app.dimensions.ai\"\n",
    "if 'google.colab' in sys.modules:\n",
    "  import getpass\n",
    "  KEY = getpass.getpass(prompt='API Key: ')  \n",
    "  dimcli.login(key=KEY, endpoint=ENDPOINT)\n",
    "else:\n",
    "  KEY = \"\"\n",
    "  dimcli.login(key=KEY, endpoint=ENDPOINT)\n",
    "dsl = dimcli.Dsl()"
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {
    "Collapsed": "false",
    "id": "NCWclPsq_Q-6"
   },
   "source": [
    "## 1. Loading and preprocessing text data\n",
    "\n",
    "Regardless of whether you are doing Global or Panel identification, the first step is to load grant application text data. A few examples will be hard coded here and loaded into a pandas dataframe. It will hopefully be trivial to alter this load step to read in data from an external source instead."
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {
    "Collapsed": "false",
    "id": "YRpszJi3Mm1S"
   },
   "source": [
    "### 1.1 Loading from File (placeholder code)\n",
    "\n",
    "General data structure needs some kind of document identifier and at least one text field. The code below relies on having the columns:\n",
    "\n",
    "* doc_id\n",
    "* title\n",
    "* abstract\n",
    "\n",
    "\n",
    "\n"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 3,
   "metadata": {
    "Collapsed": "false",
    "id": "QGa0Mt0wMDmy"
   },
   "outputs": [],
   "source": [
    "## Placeholder cell for uploading data from a file. Uncomment lines below and run if uploading file\n",
    "# from google.colab import files\n",
    "# uploaded = files.upload()"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 4,
   "metadata": {
    "Collapsed": "false",
    "id": "cu9Lhn62MdKZ"
   },
   "outputs": [],
   "source": [
    "## Uncomment below and point to uploaded file to load into pandas dataframe\n",
    "# import io\n",
    "# texts = pd.read_excel(io.BytesIO(uploaded['your_uploaded_excel.xlsx']))"
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {
    "Collapsed": "false",
    "id": "0n4AKXOtMsf3"
   },
   "source": [
    "### 1.2 Loading Sample Data\n",
    "\n",
    "Sample data used for example purposes only. If using your own data, delete or comment out this cell\n"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 5,
   "metadata": {
    "Collapsed": "false",
    "id": "efWsgatCAxLj"
   },
   "outputs": [],
   "source": [
    "grant1_identifier=\"A001\"\n",
    "grant1_title=\"Computational design of sustainable hydrogenation systems via a novel combination of data science, optimization, and ab initio methods\"\n",
    "grant1_abstract=\"\"\"Sustainable, safe, and process-intensified hydrogenation technologies are essential for distributed, small-scale, and on-demand manufacturing of chemicals and fuels from shale gas and biomass, upgrading carbon dioxide to useful organic chemicals, and upcycling plastic waste. New technological developments in this area would contribute to increasing international competitiveness of the U.S. chemical manufacturing industries and meeting relevant U.N. goals on sustainable development. A promising chemistry to this end is catalytic transfer hydrogenation (CTH), a process that is carried out using hydrogen donors instead of pure molecular H2, thereby offering a safe, H2- and potentially CO2-free hydrogenation technology. A critical step towards deploying CTH is to optimally design the underlying process, a challenging task because atomic-scale information such as reaction thermodynamics, pathways, and rates have implications at the microscopic (e.g., product yield) and macroscopic levels (e.g., process economics). The research vision of this project is to develop and apply novel computational tools, in synergy with experiments, to design CTH processes by integrating information and decisions across the different size scales. In parallel with this research, the educational vision of this project is to promote computational thinking and programming literacy at various levels of STEM education. These two skills are well-recognized as being essential for the next generation of science and engineering innovators to tackle emerging grand challenges in the energy, health, and environmental spheres. This CAREER proposal specifically aims to computationally design a vapor-phase transition-metal catalyzed CTH reaction system of a model oxygenate, viz. acrolein, which is the smallest molecule having both C-C and C-O unsaturation; as such, it can be considered a model representative of biomass-derived molecules and functionalized intermediates in the chemical industry. Designing the acrolein CTH reaction system ultimately requires identifying the optimal donor-catalyst combination that maximizes the yield of a desired product, e.g., hydrogenation selectivity of acrolein to propanal versus propenol. To this end, a novel computational framework that integrates density functional theory (DFT), informatics, machine learning, and several other process systems engineering computational methods including nonlinear optimization and advanced data sampling via reinforcement and transfer learning, will be developed as part of this research to (i) build Gaussian Process surrogate models, (ii) formulate and solve coverage-cognizant microkinetic models, and (iii) solve reaction system optimization problems. This framework will allow the PI to address a critical gap in the fundamental mechanistic elucidation and multiscale design of acrolein CTH reaction systems and thereby identify the optimal donor-catalyst combination from a representative subset of donors and transition metal catalysts. A well-integrated educational program will be developed to target different age groups at Lehigh University and the broader Lehigh valley. This includes engaging high-school and undergraduate students in cutting-edge research at the intersection of data science and catalysis, developing online interactive visualization-based modules to explain high-school science and undergraduate engineering concepts via enquiry-based learning, and developing and offering an interdisciplinary elective to train chemical engineers in the burgeoning area of data science and machine learning. This award reflects NSF's statutory mission and has been deemed worthy of support through evaluation using the Foundation's intellectual merit and broader impacts review criteria.\"\"\"\n",
    "\n",
    "grant2_identifier=\"A002\"\n",
    "grant2_title=\"Simulating catalysis: Multiscale embedding of machine learning potentials\"\n",
    "grant2_abstract=\"\"\"In the recent decades, computer simulations have become an essential part of the molecular scientist's toolbox. However, as for any computational method, molecular simulations require a compromise between speed and precision. The most precise techniques apply principles of quantum mechanics (QM) to the molecular systems and can precisely describe processes involving changes in the electronic structure, such as the breaking and forming of chemical bonds. However, they require tremendous computer resources, being prohibitively costly even for systems containing only several hundreds of atoms. On the other extreme are highly simplified \\\"Molecular Mechanics\\\" (MM) methods that ignore the quantum nature of molecules and instead describe the atoms as charged \"balls\" of certain size connected with springs representing the chemical bonds. The core limitation of MM is its inability to describe breaking/forming of chemical bonds, therefore making it unsuitable for simulating chemical reactions. This drawback motivated the invention of combined \"multiscale\" models that rely on precise but expensive QM calculations to describe the part of the simulation system where the chemical reaction takes place, while treating the rest of the system with an efficient MM method. This \"Quantum Mechanics/Molecular Mechanics\" approach (QM/MM), honoured by the Nobel Prize in Chemistry in 2013, is now the state-of-the-art simulation technique for reactions in complex environments, such as those happening inside living organisms. Such simulations are important to understand and design catalysts, which increase the rate of chemical reactions (and can thereby reduce the amount of energy and resources required to produce molecules). However, QM/MM calculations are still only as fast as the QM method used, limiting dramatically the precision and timescale of the simulations. A completely different approach is to employ techniques from the rapidly evolving field of machine learning (ML) and construct a method that can learn and then predict the outcome of a QM calculation. Once properly trained, an ML model can provide results with QM quality, but several orders of magnitude faster. However, ML models are still significantly slower than MM ones. Therefore, a multiscale \"ML/MM\" model would still offer huge savings of computer time compared to pure ML simulations. Unfortunately, however, existing ML training schemes are only suitable for calculations in gas phase and cannot take into account the presence of an MM environment. The goal of the proposed research project is to develop a novel multiscale embedding approach that will allow the use of ML models as part of a ML/MM scheme. This will enable molecular simulations of unprecedented precision on processes with high complexity without limiting the detailed exploration of molecular conformations. To achieve this goal, we will take advantage of recent advances in machine learning and understanding of intermolecular interactions to develop a specialised ML workflow that predicts the interaction energy between the molecule described by ML and the MM environment. The workflow will be implemented as an open, publicly available software package that allows to train ML/MM models and run ML/MM molecular dynamics simulations of complex chemical processes, such as catalysed reactions. We expect this package to be readily adopted by a wide community of computational chemists working on enzymatic reactions, homo/heterogeneous catalysis and generally on processes in condensed phases, aided by specific training materials and workshops that we will provide. This will allow, for example, the development efficient computational workflows to understand and help design catalysts for more environmentally friendly production of desired molecules.\"\"\"\n",
    "\n",
    "texts=pd.DataFrame(data=[[grant1_identifier,grant1_title,grant1_abstract],\n",
    "                         [grant2_identifier,grant2_title,grant2_abstract]],\n",
    "                   columns=['doc_id','title','abstract'])\n",
    "\n"
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {
    "Collapsed": "false",
    "id": "GWmVvLDqDWvS"
   },
   "source": [
    "### 1.3 Preprocess data and extract concepts\n",
    "\n",
    "Additional text cleaning steps may be required if input data is messy. Details of text cleaning are beyond the scope of this tutorial. \n",
    "\n",
    "It is worth mentioning that certain special characters may cause the Dimensions Analytics API to fail. When in doubt, remove all non-alphanumeric characters and ensure text is utf-8 encoded."
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 6,
   "metadata": {
    "Collapsed": "false",
    "colab": {
     "base_uri": "https://localhost:8080/",
     "height": 643
    },
    "executionInfo": {
     "elapsed": 3866,
     "status": "ok",
     "timestamp": 1623437122436,
     "user": {
      "displayName": "Derek Denning",
      "photoUrl": "",
      "userId": "01288319615638558065"
     },
     "user_tz": 240
    },
    "id": "YgCryNNpC-tG",
    "outputId": "902774c1-f441-4966-eaca-ea8e54a73754"
   },
   "outputs": [
    {
     "data": {
      "text/html": [
       "<div>\n",
       "<style scoped>\n",
       "    .dataframe tbody tr th:only-of-type {\n",
       "        vertical-align: middle;\n",
       "    }\n",
       "\n",
       "    .dataframe tbody tr th {\n",
       "        vertical-align: top;\n",
       "    }\n",
       "\n",
       "    .dataframe thead th {\n",
       "        text-align: right;\n",
       "    }\n",
       "</style>\n",
       "<table border=\"1\" class=\"dataframe\">\n",
       "  <thead>\n",
       "    <tr style=\"text-align: right;\">\n",
       "      <th></th>\n",
       "      <th>doc_id</th>\n",
       "      <th>title</th>\n",
       "      <th>abstract</th>\n",
       "      <th>concepts</th>\n",
       "    </tr>\n",
       "  </thead>\n",
       "  <tbody>\n",
       "    <tr>\n",
       "      <th>0</th>\n",
       "      <td>A001</td>\n",
       "      <td>Computational design of sustainable hydrogenat...</td>\n",
       "      <td>Sustainable, safe, and process-intensified hyd...</td>\n",
       "      <td>[hydrogenation technology, reaction system, ca...</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>1</th>\n",
       "      <td>A002</td>\n",
       "      <td>Simulating catalysis: Multiscale embedding of ...</td>\n",
       "      <td>In the recent decades, computer simulations ha...</td>\n",
       "      <td>[chemical bonds, chemical reactions, QM calcul...</td>\n",
       "    </tr>\n",
       "  </tbody>\n",
       "</table>\n",
       "</div>"
      ],
      "text/plain": [
       "  doc_id                                              title  \\\n",
       "0   A001  Computational design of sustainable hydrogenat...   \n",
       "1   A002  Simulating catalysis: Multiscale embedding of ...   \n",
       "\n",
       "                                            abstract  \\\n",
       "0  Sustainable, safe, and process-intensified hyd...   \n",
       "1  In the recent decades, computer simulations ha...   \n",
       "\n",
       "                                            concepts  \n",
       "0  [hydrogenation technology, reaction system, ca...  \n",
       "1  [chemical bonds, chemical reactions, QM calcul...  "
      ]
     },
     "execution_count": 6,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "# It is easiest to have a single text field to extract concepts from. There may be advanced use cases where title and abstract concepts might be handled seperately in order to produce different results.\n",
    "texts['text']=texts['title'].fillna('')+' '+texts['abstract'].fillna('')\n",
    "\n",
    "#simple regex to remove most non-alphanumeric, non-space, non-punctuation characters\n",
    "texts['text']=texts['text'].str.replace('[^a-zA-Z0-9 \\.,]', ' ',regex=True)\n",
    "\n",
    "#force text encoding to utf-8\n",
    "texts['text']=texts['text'].str.encode('utf-8')\n",
    "\n",
    "#query for concepts\n",
    "for idx,series in texts.iterrows():\n",
    "  res = dsl.query(f\"\"\"extract_concepts(\"{series['text']}\")\"\"\")\n",
    "  concepts=  res['extracted_concepts']\n",
    "  texts.loc[idx,'concepts']=';'.join(concepts)\n",
    "\n",
    "\n",
    "#format concepts into python list\n",
    "texts['concepts']=texts['concepts'].str.split(';')\n",
    "\n",
    "#it is generally desirable to narrow the list of concepts to the top concepts to reduce noise. Concepts are returned ranked by relevance, so the top N most relevant concpets are used\n",
    "topN_concepts=20\n",
    "texts['concepts']=texts['concepts'].str[:topN_concepts]\n",
    "\n",
    "#drop the now superfluous text column\n",
    "texts=texts.drop(columns=['text'])\n",
    "\n",
    "#display data preview\n",
    "texts.head()"
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {
    "Collapsed": "false",
    "id": "8_QVgvhHM_Xo"
   },
   "source": [
    "with concepts in hand, we can now begin to identify reviewers"
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {
    "Collapsed": "false",
    "id": "hOBJKYLDkftI"
   },
   "source": [
    "## 2. The Two Use Cases - Recap"
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {
    "Collapsed": "false",
    "id": "gZx5fQVqAcrk"
   },
   "source": [
    "### 2.1 Global identification use case\n",
    "\n",
    "This approach is most commonly used when potential reviewers aren't limited to a pre-determined group of people. In this case, any researcher listed in Dimensions is a potential match. This is the only mode available in the GUI described above. While a global search casts a very wide net, it is possible to use additional data attached to researcher profiles in Dimensions to filter results to a less broad subset. Some examples:\n",
    "- Only researchers from a particular country\n",
    "- Only researchers from a particular organization\n",
    "- Only researchers that have been previously funded by a particular funder\n",
    "\n"
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {
    "Collapsed": "false",
    "id": "ZD8UpFduAfjV"
   },
   "source": [
    "### 2.2 Panel identification use case\n",
    "\n",
    "Sometimes reviewers must be identified from a specific list of researchers. This can be thought of as similar to the global search above, but attempting to identify reviewers from only a very particular subset of researchers.\n",
    "\n",
    "Another common use case though is to attempt to **rank the best reviewers** for a grant application among a preselected panel **in order to assign reviewers to grant applications**. If a body of multiple grants and review panelists are known, a \"reviewer matrix\" can be generated in order to visualize the best reviewers for each appliction, as well as any potential gaps in coverage.\n",
    "\n",
    "_NOTE (May 2021): Use of the Dimensions Analytics API to generate a reviewer matrix is still in beta and undergoing review. The overall workflow is likely to remain the same, but changes under the hood may produce slightly different results in the future._"
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {
    "Collapsed": "false",
    "id": "WwCSCCPu19zN"
   },
   "source": [
    "## 3. Global identification"
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {
    "Collapsed": "false",
    "id": "lawHPY0YcZau"
   },
   "source": [
    "The basic query structure used to identify researchers based on concepts is laid out below. \n",
    "\n",
    "By default the query returns only the top 20 researchers. Up to 200 researchers can be returned by paginating queries. It is generally desired to filter these results somehow, which will be covered in the advanced use cases laid out below.\n",
    "\n",
    "For more on Dimensions researcher data and what the returned fields mean, see [the documentation for the researchers data source](https://docs.dimensions.ai/dsl/datasource-researchers.html)."
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 7,
   "metadata": {
    "Collapsed": "false",
    "colab": {
     "base_uri": "https://localhost:8080/",
     "height": 355
    },
    "executionInfo": {
     "elapsed": 7445,
     "status": "ok",
     "timestamp": 1623437132129,
     "user": {
      "displayName": "Derek Denning",
      "photoUrl": "",
      "userId": "01288319615638558065"
     },
     "user_tz": 240
    },
    "id": "X8GaYW0srXek",
    "outputId": "5ff63c5e-d08f-44a5-c9c1-533d73601c14"
   },
   "outputs": [
    {
     "data": {
      "text/html": [
       "<div>\n",
       "<style scoped>\n",
       "    .dataframe tbody tr th:only-of-type {\n",
       "        vertical-align: middle;\n",
       "    }\n",
       "\n",
       "    .dataframe tbody tr th {\n",
       "        vertical-align: top;\n",
       "    }\n",
       "\n",
       "    .dataframe thead th {\n",
       "        text-align: right;\n",
       "    }\n",
       "</style>\n",
       "<table border=\"1\" class=\"dataframe\">\n",
       "  <thead>\n",
       "    <tr style=\"text-align: right;\">\n",
       "      <th></th>\n",
       "      <th>current_research_org</th>\n",
       "      <th>docs_found</th>\n",
       "      <th>first_grant_year</th>\n",
       "      <th>first_name</th>\n",
       "      <th>first_publication_year</th>\n",
       "      <th>researcher_id</th>\n",
       "      <th>last_grant_year</th>\n",
       "      <th>last_name</th>\n",
       "      <th>last_publication_year</th>\n",
       "      <th>orcid_id</th>\n",
       "      <th>research_orgs</th>\n",
       "      <th>score</th>\n",
       "      <th>total_grants</th>\n",
       "      <th>total_publications</th>\n",
       "      <th>match_for_doc_id</th>\n",
       "    </tr>\n",
       "  </thead>\n",
       "  <tbody>\n",
       "    <tr>\n",
       "      <th>0</th>\n",
       "      <td>grid.412392.f</td>\n",
       "      <td>9</td>\n",
       "      <td>2007.0</td>\n",
       "      <td>Patrick</td>\n",
       "      <td>2000</td>\n",
       "      <td>ur.013717027613.00</td>\n",
       "      <td>2025.0</td>\n",
       "      <td>Linke</td>\n",
       "      <td>2021</td>\n",
       "      <td>[0000-0003-0105-9947]</td>\n",
       "      <td>[grid.452146.0, grid.412603.2, grid.8647.d, gr...</td>\n",
       "      <td>326.619473</td>\n",
       "      <td>11</td>\n",
       "      <td>150</td>\n",
       "      <td>A001</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>1</th>\n",
       "      <td>grid.19006.3e</td>\n",
       "      <td>8</td>\n",
       "      <td>1998.0</td>\n",
       "      <td>Panagiotis D</td>\n",
       "      <td>1994</td>\n",
       "      <td>ur.01332115004.71</td>\n",
       "      <td>2022.0</td>\n",
       "      <td>Christofides</td>\n",
       "      <td>2021</td>\n",
       "      <td>NaN</td>\n",
       "      <td>[grid.19006.3e, grid.11047.33, grid.9909.9, gr...</td>\n",
       "      <td>309.619233</td>\n",
       "      <td>12</td>\n",
       "      <td>556</td>\n",
       "      <td>A001</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>2</th>\n",
       "      <td>grid.264756.4</td>\n",
       "      <td>8</td>\n",
       "      <td>1992.0</td>\n",
       "      <td>Mahmoud M</td>\n",
       "      <td>1986</td>\n",
       "      <td>ur.01301461257.28</td>\n",
       "      <td>2021.0</td>\n",
       "      <td>El-Halwagi</td>\n",
       "      <td>2021</td>\n",
       "      <td>[0000-0002-0020-2281]</td>\n",
       "      <td>[grid.453681.d, grid.264756.4, grid.55460.32, ...</td>\n",
       "      <td>287.066961</td>\n",
       "      <td>24</td>\n",
       "      <td>528</td>\n",
       "      <td>A001</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>3</th>\n",
       "      <td>grid.147455.6</td>\n",
       "      <td>6</td>\n",
       "      <td>1980.0</td>\n",
       "      <td>Ignacio E</td>\n",
       "      <td>1978</td>\n",
       "      <td>ur.011034041563.31</td>\n",
       "      <td>2021.0</td>\n",
       "      <td>Grossmann</td>\n",
       "      <td>2021</td>\n",
       "      <td>[0000-0002-7210-084X]</td>\n",
       "      <td>[grid.37172.30, grid.187073.a, grid.7445.2, gr...</td>\n",
       "      <td>228.951728</td>\n",
       "      <td>37</td>\n",
       "      <td>778</td>\n",
       "      <td>A001</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>4</th>\n",
       "      <td>grid.264756.4</td>\n",
       "      <td>5</td>\n",
       "      <td>2007.0</td>\n",
       "      <td>Efstratios N</td>\n",
       "      <td>1988</td>\n",
       "      <td>ur.011111004073.75</td>\n",
       "      <td>2023.0</td>\n",
       "      <td>Pistikopoulos</td>\n",
       "      <td>2021</td>\n",
       "      <td>NaN</td>\n",
       "      <td>[grid.461183.9, grid.169077.e, grid.89336.37, ...</td>\n",
       "      <td>177.012200</td>\n",
       "      <td>13</td>\n",
       "      <td>608</td>\n",
       "      <td>A001</td>\n",
       "    </tr>\n",
       "  </tbody>\n",
       "</table>\n",
       "</div>"
      ],
      "text/plain": [
       "  current_research_org  docs_found  first_grant_year    first_name  \\\n",
       "0        grid.412392.f           9            2007.0       Patrick   \n",
       "1        grid.19006.3e           8            1998.0  Panagiotis D   \n",
       "2        grid.264756.4           8            1992.0     Mahmoud M   \n",
       "3        grid.147455.6           6            1980.0     Ignacio E   \n",
       "4        grid.264756.4           5            2007.0  Efstratios N   \n",
       "\n",
       "   first_publication_year       researcher_id  last_grant_year      last_name  \\\n",
       "0                    2000  ur.013717027613.00           2025.0          Linke   \n",
       "1                    1994   ur.01332115004.71           2022.0   Christofides   \n",
       "2                    1986   ur.01301461257.28           2021.0     El-Halwagi   \n",
       "3                    1978  ur.011034041563.31           2021.0      Grossmann   \n",
       "4                    1988  ur.011111004073.75           2023.0  Pistikopoulos   \n",
       "\n",
       "   last_publication_year               orcid_id  \\\n",
       "0                   2021  [0000-0003-0105-9947]   \n",
       "1                   2021                    NaN   \n",
       "2                   2021  [0000-0002-0020-2281]   \n",
       "3                   2021  [0000-0002-7210-084X]   \n",
       "4                   2021                    NaN   \n",
       "\n",
       "                                       research_orgs       score  \\\n",
       "0  [grid.452146.0, grid.412603.2, grid.8647.d, gr...  326.619473   \n",
       "1  [grid.19006.3e, grid.11047.33, grid.9909.9, gr...  309.619233   \n",
       "2  [grid.453681.d, grid.264756.4, grid.55460.32, ...  287.066961   \n",
       "3  [grid.37172.30, grid.187073.a, grid.7445.2, gr...  228.951728   \n",
       "4  [grid.461183.9, grid.169077.e, grid.89336.37, ...  177.012200   \n",
       "\n",
       "   total_grants  total_publications match_for_doc_id  \n",
       "0            11                 150             A001  \n",
       "1            12                 556             A001  \n",
       "2            24                 528             A001  \n",
       "3            37                 778             A001  \n",
       "4            13                 608             A001  "
      ]
     },
     "execution_count": 7,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "# instantiate dataframe to hold results\n",
    "results=pd.DataFrame()\n",
    "\n",
    "#Loop through texts and identify researchers\n",
    "for idx,series in texts.iterrows():\n",
    "  concepts_string = \" OR \".join(['\"%s\"' % x for x in series['concepts']])\n",
    "\n",
    "  q = f\"\"\"\n",
    "          identify experts\n",
    "              from concepts \"{dsl_escape(concepts_string)}\"\n",
    "          return experts[basics+extras]\n",
    "          \"\"\"\n",
    "\n",
    "  res=dsl.query(q).as_dataframe()\n",
    "  res['match_for_doc_id']=series['doc_id']\n",
    "  results=results.append(res)\n",
    "\n",
    "#rename 'id' column for clarity\n",
    "results=results.rename(columns={'id':'researcher_id'})\n",
    "\n",
    "#display data preview\n",
    "results.head()"
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {
    "Collapsed": "false",
    "id": "PZH-zYMDiway"
   },
   "source": [
    "### 3.1 Advanced Cases: Working around the limitations of global search\n",
    "\n",
    "_WARNING: The following represents an advanced use case and may require more sophisticated understanding of python and Dimensions data._\n",
    "\n",
    "At the present time (May 2021), there is no way to limit the researchers returned based on researcher attributes directly. Therefore, it is impossible to directly get only researchers who are in a certain country, or to only get researchers who work at certain organizations, etc.\n",
    "\n",
    "While we cannot apply filters to researchers directly, it _is_ possible to only use a subset publications or grants to identify researchers. These results, combined with pagination, may make it possible to collect a sufficient number of researchers having the attributes desired.\n",
    "\n",
    "All of the approaches below have one potentially significant drawback. By narrowing the set of documents searched to identify researchers **only a subset of any researcher's full Dimensions profile will be considered when making matches with these approaches**.\n",
    "\n",
    "_NOTE on Dimensions Data: Dimensions uses organizational information from [GRID](http://www.grid.ac). To learn more about GRID, and to learn how to use the Dimensions Analytics API to find an organization's GRID ID, see the tutorial: **[The Organizations API: Features Overview\n",
    "](https://api-lab.dimensions.ai/cookbooks/8-organizations/1-GRID-preview.html)**_"
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {
    "Collapsed": "false",
    "id": "GBBV9t322Ffl"
   },
   "source": [
    "#### 3.1.1 Searching based on organizational affiliation\n",
    "\n",
    "The core of the approach outlined below is to narrow to a subset of publications used to identify researchers. In this way, only publications having certain affiliation attributes, _which are derived from all publication coauthors_, will be used. \n",
    "\n",
    "For a list of all fields that can be used to narrow publications used to identify researchers, see the [publications source documentation](https://docs.dimensions.ai/dsl/datasource-publications.html)\n",
    "\n",
    "**This approach will collect some researchers who do not have the attributes desired**. To get a well populated list of researchers having the desired attributes, we are going to paginate through a larger set of results, then filter down to only those having the desired attributes."
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 8,
   "metadata": {
    "Collapsed": "false",
    "colab": {
     "base_uri": "https://localhost:8080/",
     "height": 371
    },
    "executionInfo": {
     "elapsed": 17700,
     "status": "ok",
     "timestamp": 1623437149825,
     "user": {
      "displayName": "Derek Denning",
      "photoUrl": "",
      "userId": "01288319615638558065"
     },
     "user_tz": 240
    },
    "id": "9e_RVa4ky0jY",
    "outputId": "895058e5-aa76-4192-a8f0-76c809d3a25a"
   },
   "outputs": [
    {
     "data": {
      "text/html": [
       "<div>\n",
       "<style scoped>\n",
       "    .dataframe tbody tr th:only-of-type {\n",
       "        vertical-align: middle;\n",
       "    }\n",
       "\n",
       "    .dataframe tbody tr th {\n",
       "        vertical-align: top;\n",
       "    }\n",
       "\n",
       "    .dataframe thead th {\n",
       "        text-align: right;\n",
       "    }\n",
       "</style>\n",
       "<table border=\"1\" class=\"dataframe\">\n",
       "  <thead>\n",
       "    <tr style=\"text-align: right;\">\n",
       "      <th></th>\n",
       "      <th>current_research_org</th>\n",
       "      <th>docs_found</th>\n",
       "      <th>first_grant_year</th>\n",
       "      <th>first_name</th>\n",
       "      <th>first_publication_year</th>\n",
       "      <th>researcher_id</th>\n",
       "      <th>last_grant_year</th>\n",
       "      <th>last_name</th>\n",
       "      <th>last_publication_year</th>\n",
       "      <th>research_orgs</th>\n",
       "      <th>score</th>\n",
       "      <th>total_grants</th>\n",
       "      <th>total_publications</th>\n",
       "      <th>orcid_id</th>\n",
       "      <th>match_for_doc_id</th>\n",
       "    </tr>\n",
       "  </thead>\n",
       "  <tbody>\n",
       "    <tr>\n",
       "      <th>0</th>\n",
       "      <td>grid.19006.3e</td>\n",
       "      <td>51</td>\n",
       "      <td>1998.0</td>\n",
       "      <td>Panagiotis D</td>\n",
       "      <td>1994</td>\n",
       "      <td>ur.01332115004.71</td>\n",
       "      <td>2022.0</td>\n",
       "      <td>Christofides</td>\n",
       "      <td>2021</td>\n",
       "      <td>[grid.19006.3e, grid.11047.33, grid.9909.9, gr...</td>\n",
       "      <td>1357.636616</td>\n",
       "      <td>12</td>\n",
       "      <td>556</td>\n",
       "      <td>NaN</td>\n",
       "      <td>A001</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>1</th>\n",
       "      <td>grid.27860.3b</td>\n",
       "      <td>24</td>\n",
       "      <td>2008.0</td>\n",
       "      <td>Nael H</td>\n",
       "      <td>1999</td>\n",
       "      <td>ur.010424362775.61</td>\n",
       "      <td>2018.0</td>\n",
       "      <td>El-Farra</td>\n",
       "      <td>2021</td>\n",
       "      <td>[grid.19006.3e, grid.27860.3b]</td>\n",
       "      <td>544.685241</td>\n",
       "      <td>2</td>\n",
       "      <td>180</td>\n",
       "      <td>[0000-0002-1973-0287]</td>\n",
       "      <td>A001</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>2</th>\n",
       "      <td>grid.27860.3b</td>\n",
       "      <td>13</td>\n",
       "      <td>NaN</td>\n",
       "      <td>Matthew J</td>\n",
       "      <td>2013</td>\n",
       "      <td>ur.011052655503.89</td>\n",
       "      <td>NaN</td>\n",
       "      <td>Ellis</td>\n",
       "      <td>2021</td>\n",
       "      <td>[grid.467448.d, grid.27860.3b, grid.19006.3e]</td>\n",
       "      <td>383.632797</td>\n",
       "      <td>0</td>\n",
       "      <td>52</td>\n",
       "      <td>[0000-0003-3764-7783]</td>\n",
       "      <td>A001</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>3</th>\n",
       "      <td>grid.266100.3</td>\n",
       "      <td>17</td>\n",
       "      <td>1999.0</td>\n",
       "      <td>Andrew B</td>\n",
       "      <td>1984</td>\n",
       "      <td>ur.013652717041.62</td>\n",
       "      <td>2026.0</td>\n",
       "      <td>Kahng</td>\n",
       "      <td>2021</td>\n",
       "      <td>[grid.30389.31, grid.19006.3e, grid.418547.b, ...</td>\n",
       "      <td>358.588582</td>\n",
       "      <td>11</td>\n",
       "      <td>580</td>\n",
       "      <td>NaN</td>\n",
       "      <td>A001</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>4</th>\n",
       "      <td>grid.47840.3f</td>\n",
       "      <td>17</td>\n",
       "      <td>2011.0</td>\n",
       "      <td>Alberto Luigi</td>\n",
       "      <td>1976</td>\n",
       "      <td>ur.010253255177.83</td>\n",
       "      <td>2021.0</td>\n",
       "      <td>Sangiovanni-Vincentelli</td>\n",
       "      <td>2021</td>\n",
       "      <td>[grid.263145.7, grid.425176.3, grid.6738.a, gr...</td>\n",
       "      <td>349.959567</td>\n",
       "      <td>4</td>\n",
       "      <td>798</td>\n",
       "      <td>[0000-0003-1298-8389]</td>\n",
       "      <td>A001</td>\n",
       "    </tr>\n",
       "  </tbody>\n",
       "</table>\n",
       "</div>"
      ],
      "text/plain": [
       "  current_research_org  docs_found  first_grant_year     first_name  \\\n",
       "0        grid.19006.3e          51            1998.0   Panagiotis D   \n",
       "1        grid.27860.3b          24            2008.0         Nael H   \n",
       "2        grid.27860.3b          13               NaN      Matthew J   \n",
       "3        grid.266100.3          17            1999.0       Andrew B   \n",
       "4        grid.47840.3f          17            2011.0  Alberto Luigi   \n",
       "\n",
       "   first_publication_year       researcher_id  last_grant_year  \\\n",
       "0                    1994   ur.01332115004.71           2022.0   \n",
       "1                    1999  ur.010424362775.61           2018.0   \n",
       "2                    2013  ur.011052655503.89              NaN   \n",
       "3                    1984  ur.013652717041.62           2026.0   \n",
       "4                    1976  ur.010253255177.83           2021.0   \n",
       "\n",
       "                 last_name  last_publication_year  \\\n",
       "0             Christofides                   2021   \n",
       "1                 El-Farra                   2021   \n",
       "2                    Ellis                   2021   \n",
       "3                    Kahng                   2021   \n",
       "4  Sangiovanni-Vincentelli                   2021   \n",
       "\n",
       "                                       research_orgs        score  \\\n",
       "0  [grid.19006.3e, grid.11047.33, grid.9909.9, gr...  1357.636616   \n",
       "1                     [grid.19006.3e, grid.27860.3b]   544.685241   \n",
       "2      [grid.467448.d, grid.27860.3b, grid.19006.3e]   383.632797   \n",
       "3  [grid.30389.31, grid.19006.3e, grid.418547.b, ...   358.588582   \n",
       "4  [grid.263145.7, grid.425176.3, grid.6738.a, gr...   349.959567   \n",
       "\n",
       "   total_grants  total_publications               orcid_id match_for_doc_id  \n",
       "0            12                 556                    NaN             A001  \n",
       "1             2                 180  [0000-0002-1973-0287]             A001  \n",
       "2             0                  52  [0000-0003-3764-7783]             A001  \n",
       "3            11                 580                    NaN             A001  \n",
       "4             4                 798  [0000-0003-1298-8389]             A001  "
      ]
     },
     "execution_count": 8,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "# List of GRID IDs of research orgs\n",
    "# Example here is a list of GRID IDs for schools in the University of California system\n",
    "orgs_list = [\"grid.19006.3e\",\n",
    "             \"grid.47840.3f\",\n",
    "             \"grid.266100.3\",\n",
    "             \"grid.30389.31\",\n",
    "             \"grid.266102.1\",\n",
    "             \"grid.27860.3b\",\n",
    "             \"grid.266093.8\",\n",
    "             \"grid.133342.4\",\n",
    "             \"grid.205975.c\",\n",
    "             \"grid.266097.c\"]\n",
    "\n",
    "# instantiate dataframe to hold results\n",
    "results=pd.DataFrame()\n",
    "\n",
    "#Loop through texts and identify researchers\n",
    "for idx,series in texts.iterrows():\n",
    "  concepts_string = \" OR \".join(['\"%s\"' % x for x in series['concepts']])\n",
    "  # paginate through results\n",
    "  for k in range(0,200,20):\n",
    "    q = f\"\"\"\n",
    "            identify experts\n",
    "                from concepts \"{dsl_escape(concepts_string)}\"\n",
    "                using publications \n",
    "                where research_orgs in {json.dumps(orgs_list)}\n",
    "            return experts[basics+extras]\n",
    "            limit 20 skip {k}\n",
    "            \"\"\"\n",
    "\n",
    "    res=dsl.query(q).as_dataframe()\n",
    "    res['match_for_doc_id']=series['doc_id']\n",
    "    results=results.append(res)\n",
    "\n",
    "# Filter results to researchers whose current affiliation is in orgs list\n",
    "results=results[results['current_research_org'].isin(orgs_list)]\n",
    "\n",
    "#rename 'id' column for clarity\n",
    "results=results.rename(columns={'id':'researcher_id'})\n",
    "\n",
    "#display data preview\n",
    "results.head()  "
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {
    "Collapsed": "false",
    "id": "HuqzYHkx1zQk"
   },
   "source": [
    "#### 3.1.2 Searching based on previous funding history\n",
    "\n",
    "This approach will identify only researchers who have recieved grants from specific funders, identified by their GRID IDs. With this approach, pagination and further filtering is not necessary.\n",
    "\n",
    "For a list of all fields that can be used to narrow grants used, see the [grants source documentation](https://docs.dimensions.ai/dsl/datasource-grants.html)\n",
    "\n",
    "There are trade-offs to the approach outlined below. While \"_using grants_\" will allow you to very directly line up with researcher who have recieved grants from specific funders, it will  **only search grant texts** - not publication texts - when finding matches. \n"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 9,
   "metadata": {
    "Collapsed": "false",
    "id": "43gzkWcWHpMK"
   },
   "outputs": [
    {
     "data": {
      "text/html": [
       "<div>\n",
       "<style scoped>\n",
       "    .dataframe tbody tr th:only-of-type {\n",
       "        vertical-align: middle;\n",
       "    }\n",
       "\n",
       "    .dataframe tbody tr th {\n",
       "        vertical-align: top;\n",
       "    }\n",
       "\n",
       "    .dataframe thead th {\n",
       "        text-align: right;\n",
       "    }\n",
       "</style>\n",
       "<table border=\"1\" class=\"dataframe\">\n",
       "  <thead>\n",
       "    <tr style=\"text-align: right;\">\n",
       "      <th></th>\n",
       "      <th>current_research_org</th>\n",
       "      <th>docs_found</th>\n",
       "      <th>first_grant_year</th>\n",
       "      <th>first_name</th>\n",
       "      <th>first_publication_year</th>\n",
       "      <th>researcher_id</th>\n",
       "      <th>last_grant_year</th>\n",
       "      <th>last_name</th>\n",
       "      <th>last_publication_year</th>\n",
       "      <th>research_orgs</th>\n",
       "      <th>score</th>\n",
       "      <th>total_grants</th>\n",
       "      <th>total_publications</th>\n",
       "      <th>orcid_id</th>\n",
       "      <th>match_for_doc_id</th>\n",
       "    </tr>\n",
       "  </thead>\n",
       "  <tbody>\n",
       "    <tr>\n",
       "      <th>0</th>\n",
       "      <td>grid.259029.5</td>\n",
       "      <td>1</td>\n",
       "      <td>2018</td>\n",
       "      <td>Srinivas</td>\n",
       "      <td>2015.0</td>\n",
       "      <td>ur.013102571772.72</td>\n",
       "      <td>2026</td>\n",
       "      <td>Rangarajan</td>\n",
       "      <td>2021.0</td>\n",
       "      <td>[grid.14003.36, grid.259029.5]</td>\n",
       "      <td>2.567357</td>\n",
       "      <td>4</td>\n",
       "      <td>31</td>\n",
       "      <td>NaN</td>\n",
       "      <td>A001</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>1</th>\n",
       "      <td>grid.147455.6</td>\n",
       "      <td>8</td>\n",
       "      <td>1980</td>\n",
       "      <td>Ignacio E</td>\n",
       "      <td>1978.0</td>\n",
       "      <td>ur.011034041563.31</td>\n",
       "      <td>2021</td>\n",
       "      <td>Grossmann</td>\n",
       "      <td>2021.0</td>\n",
       "      <td>[grid.37172.30, grid.187073.a, grid.7445.2, gr...</td>\n",
       "      <td>0.808810</td>\n",
       "      <td>37</td>\n",
       "      <td>778</td>\n",
       "      <td>[0000-0002-7210-084X]</td>\n",
       "      <td>A001</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>2</th>\n",
       "      <td>grid.147455.6</td>\n",
       "      <td>8</td>\n",
       "      <td>1982</td>\n",
       "      <td>Lorenz Theodor</td>\n",
       "      <td>1982.0</td>\n",
       "      <td>ur.07525174375.48</td>\n",
       "      <td>2016</td>\n",
       "      <td>Biegler</td>\n",
       "      <td>2021.0</td>\n",
       "      <td>[grid.28803.31, grid.7870.8, grid.147455.6, gr...</td>\n",
       "      <td>0.593023</td>\n",
       "      <td>25</td>\n",
       "      <td>535</td>\n",
       "      <td>[0000-0003-3875-4441]</td>\n",
       "      <td>A001</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>3</th>\n",
       "      <td>grid.33489.35</td>\n",
       "      <td>5</td>\n",
       "      <td>2000</td>\n",
       "      <td>Marianthi G</td>\n",
       "      <td>1994.0</td>\n",
       "      <td>ur.01326503420.77</td>\n",
       "      <td>2025</td>\n",
       "      <td>Ierapetritou</td>\n",
       "      <td>2021.0</td>\n",
       "      <td>[grid.7445.2, grid.430387.b, grid.33489.35, gr...</td>\n",
       "      <td>0.590299</td>\n",
       "      <td>25</td>\n",
       "      <td>331</td>\n",
       "      <td>[0000-0002-1758-9777]</td>\n",
       "      <td>A001</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>4</th>\n",
       "      <td>grid.264756.4</td>\n",
       "      <td>6</td>\n",
       "      <td>1986</td>\n",
       "      <td>Christodoulos Achilleus</td>\n",
       "      <td>1986.0</td>\n",
       "      <td>ur.010407376521.12</td>\n",
       "      <td>2022</td>\n",
       "      <td>Floudas</td>\n",
       "      <td>2021.0</td>\n",
       "      <td>[grid.264756.4, grid.7445.2, grid.16750.35, gr...</td>\n",
       "      <td>0.447884</td>\n",
       "      <td>31</td>\n",
       "      <td>515</td>\n",
       "      <td>NaN</td>\n",
       "      <td>A001</td>\n",
       "    </tr>\n",
       "  </tbody>\n",
       "</table>\n",
       "</div>"
      ],
      "text/plain": [
       "  current_research_org  docs_found  first_grant_year               first_name  \\\n",
       "0        grid.259029.5           1              2018                 Srinivas   \n",
       "1        grid.147455.6           8              1980                Ignacio E   \n",
       "2        grid.147455.6           8              1982           Lorenz Theodor   \n",
       "3        grid.33489.35           5              2000              Marianthi G   \n",
       "4        grid.264756.4           6              1986  Christodoulos Achilleus   \n",
       "\n",
       "   first_publication_year       researcher_id  last_grant_year     last_name  \\\n",
       "0                  2015.0  ur.013102571772.72             2026    Rangarajan   \n",
       "1                  1978.0  ur.011034041563.31             2021     Grossmann   \n",
       "2                  1982.0   ur.07525174375.48             2016       Biegler   \n",
       "3                  1994.0   ur.01326503420.77             2025  Ierapetritou   \n",
       "4                  1986.0  ur.010407376521.12             2022       Floudas   \n",
       "\n",
       "   last_publication_year                                      research_orgs  \\\n",
       "0                 2021.0                     [grid.14003.36, grid.259029.5]   \n",
       "1                 2021.0  [grid.37172.30, grid.187073.a, grid.7445.2, gr...   \n",
       "2                 2021.0  [grid.28803.31, grid.7870.8, grid.147455.6, gr...   \n",
       "3                 2021.0  [grid.7445.2, grid.430387.b, grid.33489.35, gr...   \n",
       "4                 2021.0  [grid.264756.4, grid.7445.2, grid.16750.35, gr...   \n",
       "\n",
       "      score  total_grants  total_publications               orcid_id  \\\n",
       "0  2.567357             4                  31                    NaN   \n",
       "1  0.808810            37                 778  [0000-0002-7210-084X]   \n",
       "2  0.593023            25                 535  [0000-0003-3875-4441]   \n",
       "3  0.590299            25                 331  [0000-0002-1758-9777]   \n",
       "4  0.447884            31                 515                    NaN   \n",
       "\n",
       "  match_for_doc_id  \n",
       "0             A001  \n",
       "1             A001  \n",
       "2             A001  \n",
       "3             A001  \n",
       "4             A001  "
      ]
     },
     "execution_count": 9,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "#list of GRID IDs of funders\n",
    "# Example here is a list of GRID IDs for directorates of the US National Science Foundation\n",
    "funders_list=[\"grid.457810.f\",\n",
    "              \"grid.457875.c\",\n",
    "              \"grid.457785.c\",\n",
    "              \"grid.457768.f\",\n",
    "              \"grid.457836.b\",\n",
    "              \"grid.457916.8\"]\n",
    "\n",
    "# instantiate dataframe to hold results\n",
    "results=pd.DataFrame()\n",
    "\n",
    "# funders_string = '[\"{}\"]'.format('\",\"'.join(funders_list))\n",
    "#Loop through texts and identify researchers\n",
    "for idx,series in texts.iterrows():\n",
    "  concepts_string = \" OR \".join(['\"%s\"' % x for x in series['concepts']])\n",
    "\n",
    "  q = f\"\"\"\n",
    "          identify experts\n",
    "              from concepts \"{dsl_escape(concepts_string)}\"\n",
    "              using grants \n",
    "              where funders.id in {json.dumps(funders_list)}\n",
    "          return experts[basics+extras]\n",
    "          \"\"\"\n",
    "\n",
    "  res=dsl.query(q).as_dataframe()\n",
    "  res['match_for_doc_id']=series['doc_id']\n",
    "  results=results.append(res)\n",
    "\n",
    "#rename 'id' column for clarity\n",
    "results=results.rename(columns={'id':'researcher_id'})\n",
    "\n",
    "#display data preview\n",
    "results.head()"
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {
    "Collapsed": "false",
    "id": "IG1hIIumivlz"
   },
   "source": [
    "## 4. Panel Identification"
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {
    "Collapsed": "false",
    "id": "BMhCYP8TSs6C"
   },
   "source": [
    "The use of panels of researchers to review grant applications is wide spread. Once a panel of researchers is identified, assignments must be made between individual researchers and individual applications. It is often the case that applications span a range of topics and subtopics, and that panelists may only have expertise in some of these areas. To conduct a fair review, it is necessary to align panelist expertise and application topic as best as possible.\n",
    "\n",
    "The Dimensions Analytics API includes utilities to make these assignments easier. It is possible to calculate a numeric score for how well a reviewer's research profile aligns with with grant application texts. By building a matrix of reviewer-application scores, it can become very easy to visualize best assignments, as well as to identify possible gap areas.\n",
    "\n",
    "---\n",
    "\n",
    "This approach relies on Dimensions researcher profiles. For more on Dimensions researcher profiles generally and how to search for them, see [here](https://support-funder.dimensions.ai/support/solutions/articles/13000065159-how-can-i-search-for-a-person-researcher-).\n",
    "\n",
    "For more on how to find particular researcher profiles using the API, see [this link](https://docs.dimensions.ai/dsl/language.html#searching-for-researchers) or the tutorial **[Extracting researchers based on affiliations and publications history](https://api-lab.dimensions.ai/cookbooks/7-researchers/Researchers-Search-tips-V2.html)**"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 10,
   "metadata": {
    "Collapsed": "false",
    "colab": {
     "base_uri": "https://localhost:8080/",
     "height": 158
    },
    "executionInfo": {
     "elapsed": 1770,
     "status": "ok",
     "timestamp": 1623437155858,
     "user": {
      "displayName": "Derek Denning",
      "photoUrl": "",
      "userId": "01288319615638558065"
     },
     "user_tz": 240
    },
    "id": "ombDHN4Ra8xz",
    "outputId": "0085c27b-a86f-455b-97d3-cb38c67071ae"
   },
   "outputs": [
    {
     "data": {
      "text/html": [
       "<style type=\"text/css\">\n",
       "#T_85c85_row0_col0 {\n",
       "  background-color: #bed8ec;\n",
       "  color: #000000;\n",
       "}\n",
       "#T_85c85_row0_col1 {\n",
       "  background-color: #d0e2f2;\n",
       "  color: #000000;\n",
       "}\n",
       "#T_85c85_row1_col0, #T_85c85_row4_col1 {\n",
       "  background-color: #f7fbff;\n",
       "  color: #000000;\n",
       "}\n",
       "#T_85c85_row1_col1 {\n",
       "  background-color: #eaf3fb;\n",
       "  color: #000000;\n",
       "}\n",
       "#T_85c85_row2_col0, #T_85c85_row2_col1 {\n",
       "  background-color: #08306b;\n",
       "  color: #f1f1f1;\n",
       "}\n",
       "#T_85c85_row3_col0 {\n",
       "  background-color: #f5fafe;\n",
       "  color: #000000;\n",
       "}\n",
       "#T_85c85_row3_col1 {\n",
       "  background-color: #dceaf6;\n",
       "  color: #000000;\n",
       "}\n",
       "#T_85c85_row4_col0 {\n",
       "  background-color: #f4f9fe;\n",
       "  color: #000000;\n",
       "}\n",
       "</style>\n",
       "<table id=\"T_85c85_\">\n",
       "  <thead>\n",
       "    <tr>\n",
       "      <th class=\"blank level0\" >&nbsp;</th>\n",
       "      <th class=\"col_heading level0 col0\" >A001</th>\n",
       "      <th class=\"col_heading level0 col1\" >A002</th>\n",
       "      <th class=\"col_heading level0 col2\" >current_research_org</th>\n",
       "      <th class=\"col_heading level0 col3\" >docs_found</th>\n",
       "      <th class=\"col_heading level0 col4\" >first_grant_year</th>\n",
       "      <th class=\"col_heading level0 col5\" >first_name</th>\n",
       "      <th class=\"col_heading level0 col6\" >first_publication_year</th>\n",
       "      <th class=\"col_heading level0 col7\" >last_grant_year</th>\n",
       "      <th class=\"col_heading level0 col8\" >last_name</th>\n",
       "      <th class=\"col_heading level0 col9\" >last_publication_year</th>\n",
       "      <th class=\"col_heading level0 col10\" >orcid_id</th>\n",
       "      <th class=\"col_heading level0 col11\" >research_orgs</th>\n",
       "      <th class=\"col_heading level0 col12\" >total_grants</th>\n",
       "      <th class=\"col_heading level0 col13\" >total_publications</th>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th class=\"index_name level0\" >researcher_id</th>\n",
       "      <th class=\"blank col0\" >&nbsp;</th>\n",
       "      <th class=\"blank col1\" >&nbsp;</th>\n",
       "      <th class=\"blank col2\" >&nbsp;</th>\n",
       "      <th class=\"blank col3\" >&nbsp;</th>\n",
       "      <th class=\"blank col4\" >&nbsp;</th>\n",
       "      <th class=\"blank col5\" >&nbsp;</th>\n",
       "      <th class=\"blank col6\" >&nbsp;</th>\n",
       "      <th class=\"blank col7\" >&nbsp;</th>\n",
       "      <th class=\"blank col8\" >&nbsp;</th>\n",
       "      <th class=\"blank col9\" >&nbsp;</th>\n",
       "      <th class=\"blank col10\" >&nbsp;</th>\n",
       "      <th class=\"blank col11\" >&nbsp;</th>\n",
       "      <th class=\"blank col12\" >&nbsp;</th>\n",
       "      <th class=\"blank col13\" >&nbsp;</th>\n",
       "    </tr>\n",
       "  </thead>\n",
       "  <tbody>\n",
       "    <tr>\n",
       "      <th id=\"T_85c85_level0_row0\" class=\"row_heading level0 row0\" >ur.01050122660.53</th>\n",
       "      <td id=\"T_85c85_row0_col0\" class=\"data row0 col0\" >0.332839</td>\n",
       "      <td id=\"T_85c85_row0_col1\" class=\"data row0 col1\" >0.240871</td>\n",
       "      <td id=\"T_85c85_row0_col2\" class=\"data row0 col2\" >grid.34477.33</td>\n",
       "      <td id=\"T_85c85_row0_col3\" class=\"data row0 col3\" >80</td>\n",
       "      <td id=\"T_85c85_row0_col4\" class=\"data row0 col4\" >1983.000000</td>\n",
       "      <td id=\"T_85c85_row0_col5\" class=\"data row0 col5\" >Charles T</td>\n",
       "      <td id=\"T_85c85_row0_col6\" class=\"data row0 col6\" >1978</td>\n",
       "      <td id=\"T_85c85_row0_col7\" class=\"data row0 col7\" >2023.000000</td>\n",
       "      <td id=\"T_85c85_row0_col8\" class=\"data row0 col8\" >Campbell</td>\n",
       "      <td id=\"T_85c85_row0_col9\" class=\"data row0 col9\" >2021</td>\n",
       "      <td id=\"T_85c85_row0_col10\" class=\"data row0 col10\" >nan</td>\n",
       "      <td id=\"T_85c85_row0_col11\" class=\"data row0 col11\" >['grid.253692.9', 'grid.411377.7', 'grid.148313.c', 'grid.5379.8', 'grid.451303.0', 'grid.5335.0', 'grid.89336.37', 'grid.34477.33']</td>\n",
       "      <td id=\"T_85c85_row0_col12\" class=\"data row0 col12\" >12</td>\n",
       "      <td id=\"T_85c85_row0_col13\" class=\"data row0 col13\" >329</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th id=\"T_85c85_level0_row1\" class=\"row_heading level0 row1\" >ur.011441227347.89</th>\n",
       "      <td id=\"T_85c85_row1_col0\" class=\"data row1 col0\" >0.078677</td>\n",
       "      <td id=\"T_85c85_row1_col1\" class=\"data row1 col1\" >0.113787</td>\n",
       "      <td id=\"T_85c85_row1_col2\" class=\"data row1 col2\" >grid.410356.5</td>\n",
       "      <td id=\"T_85c85_row1_col3\" class=\"data row1 col3\" >23</td>\n",
       "      <td id=\"T_85c85_row1_col4\" class=\"data row1 col4\" >2000.000000</td>\n",
       "      <td id=\"T_85c85_row1_col5\" class=\"data row1 col5\" >Cathleen M</td>\n",
       "      <td id=\"T_85c85_row1_col6\" class=\"data row1 col6\" >1990</td>\n",
       "      <td id=\"T_85c85_row1_col7\" class=\"data row1 col7\" >2025.000000</td>\n",
       "      <td id=\"T_85c85_row1_col8\" class=\"data row1 col8\" >Crudden</td>\n",
       "      <td id=\"T_85c85_row1_col9\" class=\"data row1 col9\" >2021</td>\n",
       "      <td id=\"T_85c85_row1_col10\" class=\"data row1 col10\" >nan</td>\n",
       "      <td id=\"T_85c85_row1_col11\" class=\"data row1 col11\" >['grid.431983.4', 'grid.27476.30', 'grid.5337.2', 'grid.28046.38', 'grid.17063.33', 'grid.23856.3a', 'grid.35403.31', 'grid.266820.8', 'grid.438548.6', 'grid.292836.4', 'grid.420469.d', 'grid.410356.5']</td>\n",
       "      <td id=\"T_85c85_row1_col12\" class=\"data row1 col12\" >60</td>\n",
       "      <td id=\"T_85c85_row1_col13\" class=\"data row1 col13\" >218</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th id=\"T_85c85_level0_row2\" class=\"row_heading level0 row2\" >ur.01215263003.24</th>\n",
       "      <td id=\"T_85c85_row2_col0\" class=\"data row2 col0\" >1.000000</td>\n",
       "      <td id=\"T_85c85_row2_col1\" class=\"data row2 col1\" >1.000000</td>\n",
       "      <td id=\"T_85c85_row2_col2\" class=\"data row2 col2\" >grid.5170.3</td>\n",
       "      <td id=\"T_85c85_row2_col3\" class=\"data row2 col3\" >281</td>\n",
       "      <td id=\"T_85c85_row2_col4\" class=\"data row2 col4\" >2012.000000</td>\n",
       "      <td id=\"T_85c85_row2_col5\" class=\"data row2 col5\" >Jens Kehlet</td>\n",
       "      <td id=\"T_85c85_row2_col6\" class=\"data row2 col6\" >1977</td>\n",
       "      <td id=\"T_85c85_row2_col7\" class=\"data row2 col7\" >2015.000000</td>\n",
       "      <td id=\"T_85c85_row2_col8\" class=\"data row2 col8\" >Nrskov</td>\n",
       "      <td id=\"T_85c85_row2_col9\" class=\"data row2 col9\" >2021</td>\n",
       "      <td id=\"T_85c85_row2_col10\" class=\"data row2 col10\" >['0000-0002-4427-7728']</td>\n",
       "      <td id=\"T_85c85_row2_col11\" class=\"data row2 col11\" >['grid.7491.b', 'grid.445003.6', 'grid.424590.e', 'grid.7048.b', 'grid.10548.38', 'grid.12082.39', 'grid.168010.e', 'grid.5170.3', 'grid.410387.9', 'grid.5117.2', 'grid.5371.0', 'grid.133342.4', 'grid.418028.7', 'grid.481554.9', 'grid.253264.4']</td>\n",
       "      <td id=\"T_85c85_row2_col12\" class=\"data row2 col12\" >2</td>\n",
       "      <td id=\"T_85c85_row2_col13\" class=\"data row2 col13\" >756</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th id=\"T_85c85_level0_row3\" class=\"row_heading level0 row3\" >ur.01300337437.48</th>\n",
       "      <td id=\"T_85c85_row3_col0\" class=\"data row3 col0\" >0.086336</td>\n",
       "      <td id=\"T_85c85_row3_col1\" class=\"data row3 col1\" >0.181127</td>\n",
       "      <td id=\"T_85c85_row3_col2\" class=\"data row3 col2\" >grid.1957.a</td>\n",
       "      <td id=\"T_85c85_row3_col3\" class=\"data row3 col3\" >32</td>\n",
       "      <td id=\"T_85c85_row3_col4\" class=\"data row3 col4\" >2010.000000</td>\n",
       "      <td id=\"T_85c85_row3_col5\" class=\"data row3 col5\" >Franziska</td>\n",
       "      <td id=\"T_85c85_row3_col6\" class=\"data row3 col6\" >2005</td>\n",
       "      <td id=\"T_85c85_row3_col7\" class=\"data row3 col7\" >2025.000000</td>\n",
       "      <td id=\"T_85c85_row3_col8\" class=\"data row3 col8\" >Schoenebeck</td>\n",
       "      <td id=\"T_85c85_row3_col9\" class=\"data row3 col9\" >2021</td>\n",
       "      <td id=\"T_85c85_row3_col10\" class=\"data row3 col10\" >['0000-0003-0047-0929']</td>\n",
       "      <td id=\"T_85c85_row3_col11\" class=\"data row3 col11\" >['grid.8547.e', 'grid.19006.3e', 'grid.11984.35', 'grid.417815.e', 'grid.5801.c', 'grid.1957.a']</td>\n",
       "      <td id=\"T_85c85_row3_col12\" class=\"data row3 col12\" >7</td>\n",
       "      <td id=\"T_85c85_row3_col13\" class=\"data row3 col13\" >171</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th id=\"T_85c85_level0_row4\" class=\"row_heading level0 row4\" >ur.01367255211.93</th>\n",
       "      <td id=\"T_85c85_row4_col0\" class=\"data row4 col0\" >0.095684</td>\n",
       "      <td id=\"T_85c85_row4_col1\" class=\"data row4 col1\" >0.053079</td>\n",
       "      <td id=\"T_85c85_row4_col2\" class=\"data row4 col2\" >grid.411461.7</td>\n",
       "      <td id=\"T_85c85_row4_col3\" class=\"data row4 col3\" >26</td>\n",
       "      <td id=\"T_85c85_row4_col4\" class=\"data row4 col4\" >2018.000000</td>\n",
       "      <td id=\"T_85c85_row4_col5\" class=\"data row4 col5\" >Konstantinos D</td>\n",
       "      <td id=\"T_85c85_row4_col6\" class=\"data row4 col6\" >2009</td>\n",
       "      <td id=\"T_85c85_row4_col7\" class=\"data row4 col7\" >2022.000000</td>\n",
       "      <td id=\"T_85c85_row4_col8\" class=\"data row4 col8\" >Vogiatzis</td>\n",
       "      <td id=\"T_85c85_row4_col9\" class=\"data row4 col9\" >2021</td>\n",
       "      <td id=\"T_85c85_row4_col10\" class=\"data row4 col10\" >['0000-0002-7439-3850']</td>\n",
       "      <td id=\"T_85c85_row4_col11\" class=\"data row4 col11\" >['grid.8127.c', 'grid.17635.36', 'grid.7892.4', 'grid.267305.5', 'grid.411461.7']</td>\n",
       "      <td id=\"T_85c85_row4_col12\" class=\"data row4 col12\" >1</td>\n",
       "      <td id=\"T_85c85_row4_col13\" class=\"data row4 col13\" >63</td>\n",
       "    </tr>\n",
       "  </tbody>\n",
       "</table>\n"
      ],
      "text/plain": [
       "<pandas.io.formats.style.Styler at 0x127ec2a00>"
      ]
     },
     "execution_count": 10,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "#Curated list of panelists\n",
    "panelist_researcher_ids = [\"ur.011441227347.89\",\n",
    "                           \"ur.01300337437.48\",\n",
    "                           \"ur.01367255211.93\",\n",
    "                           \"ur.01050122660.53\",\n",
    "                           \"ur.01215263003.24\"]\n",
    "\n",
    "# instantiate dataframe to hold results\n",
    "results=pd.DataFrame()\n",
    "\n",
    "#iterate through all texts\n",
    "for idx,series in texts.iterrows():\n",
    "  concepts_string = \" OR \".join(['\"%s\"' % x for x in series['concepts']])\n",
    "  q= f\"\"\"\n",
    "          identify experts\n",
    "              from concepts \"{dsl_escape(concepts_string)}\"\n",
    "              using publications \n",
    "              where researchers in {json.dumps(panelist_researcher_ids)}\n",
    "          return experts[basics+extras]\n",
    "          \"\"\"\n",
    "\n",
    "  res=dsl.query(q).as_dataframe()\n",
    "  res['match_for_doc_id']=series['doc_id']\n",
    "  results=results.append(res)\n",
    "\n",
    "#filter to panelist IDs only\n",
    "results=results[results['id'].isin(panelist_researcher_ids)]\n",
    "\n",
    "#rename columns for clarity\n",
    "results=results.rename(columns={'id':'researcher_id',\n",
    "                        'match_for_doc_id':'doc_id'})\n",
    "\n",
    "#store researcher profile metadata seperately\n",
    "researcher_data=results.drop(columns=['score','doc_id']).drop_duplicates(['researcher_id']).set_index('researcher_id')\n",
    "\n",
    "#pivot resulting scores into researcher-document matrix\n",
    "matrix = results.pivot(index='researcher_id',columns='doc_id',values=\"score\")\n",
    "\n",
    "#normalize scores for each appl so that the best match is always scored 1\n",
    "for col in matrix.columns:\n",
    "  matrix[col]=matrix[col]/matrix[col].max()\n",
    "\n",
    "#fill missing values with 0\n",
    "matrix=matrix.fillna(0)\n",
    "\n",
    "#store grant column names to make pretty display\n",
    "grant_cols=matrix.columns\n",
    "\n",
    "#rejoin researcher metadata\n",
    "matrix=matrix.join(researcher_data)\n",
    "\n",
    "#Display matrix with colors\n",
    "matrix.style.background_gradient(subset=grant_cols,cmap='Blues')"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 11,
   "metadata": {
    "Collapsed": "false",
    "colab": {
     "base_uri": "https://localhost:8080/",
     "height": 17
    },
    "executionInfo": {
     "elapsed": 15,
     "status": "ok",
     "timestamp": 1623437155861,
     "user": {
      "displayName": "Derek Denning",
      "photoUrl": "",
      "userId": "01288319615638558065"
     },
     "user_tz": 240
    },
    "id": "xsIKRz5sdRkV",
    "outputId": "68c43825-4ae1-4bd4-cf64-65c46126306d"
   },
   "outputs": [],
   "source": [
    "\n",
    "# FINALLY - if you are using Google Colab, download the results files:\n",
    "\n",
    "if 'google.colab' in sys.modules:\n",
    "    from google.colab import files\n",
    "\n",
    "    # temporarily save pandas dataframe as file in colab environment\n",
    "    results.to_csv('results.csv')\n",
    "    # download file to local machine\n",
    "    files.download('results.csv')"
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {
    "Collapsed": "false",
    "id": "4SQnW2UFeDIz"
   },
   "source": [
    "## Conclusions\n",
    "\n",
    "In this notebook we have shown how to use the [Dimensions Analytics API](https://www.dimensions.ai/dimensions-apis/) to identify researchers to serve as reviewers for grant funders. \n",
    "\n",
    "Two general approaches have been presented: Global Identification or Panel Identification. Regardless of whether you are doing Global Identification or Panel Identification, the final output is a list of researchers for each application. Additional outputs, like the reviewer matrix, can also be exported. \n",
    "\n",
    "\n",
    "The selection of reviewers may be an interative process, and it may be desirable to try and produce different results by tuning the number of concepts used, or using a different pool of publications or grants to identify researchers. The **[Expert Identification with the Dimensions API - An Introduction\n",
    "](https://api-lab.dimensions.ai/cookbooks/7-researchers/Experts-search-introduction.html)** contains many more examples on ways to fine tune and tweak expert identification using the Dimensions Analytics API.\n",
    "\n",
    "Finally, it is worth stressing that the outputs of reviewer finding are meant to be taken with a grain of salt, and are intended to be further reviewed by human eyes. Hence this whole process is intended to aid and speed up pre-existing workflows, rather than replace them entirely. \n"
   ]
  }
 ],
 "metadata": {
  "colab": {
   "collapsed_sections": [],
   "name": "[APILAB]  Chris Wolcott - funder_reviewer_finder_api.ipynb",
   "provenance": []
  },
  "kernelspec": {
   "display_name": "Python 3 (ipykernel)",
   "language": "python",
   "name": "python3"
  },
  "language_info": {
   "codemirror_mode": {
    "name": "ipython",
    "version": 3
   },
   "file_extension": ".py",
   "mimetype": "text/x-python",
   "name": "python",
   "nbconvert_exporter": "python",
   "pygments_lexer": "ipython3",
   "version": "3.9.9"
  }
 },
 "nbformat": 4,
 "nbformat_minor": 4
}
