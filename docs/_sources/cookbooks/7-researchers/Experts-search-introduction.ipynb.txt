{
 "cells": [
  {
   "cell_type": "markdown",
   "metadata": {
    "Collapsed": "false"
   },
   "source": [
    "# Expert Identification with the Dimensions API - An Introduction\n",
    "\n",
    "This notebook shows to use the new [expert identification](https://docs.dimensions.ai/dsl/expert-identification.html) feature of Dimensions' Analytics API. \n",
    "\n",
    "The expert Identification workflow consists of two steps. \n",
    "\n",
    "In the first step, the user extracts concepts from an abstract.\n",
    "The user can review and modify the list of extracted concepts and then feed it into the actual expert identification workflow."
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {
    "Collapsed": "false",
    "colab_type": "text",
    "id": "hMaQlB7DG8Vw"
   },
   "source": [
    "## Prerequisites\n",
    "\n",
    "This notebook assumes you have installed the [Dimcli](https://pypi.org/project/dimcli/) library and are familiar with the *Getting Started* tutorial.\n"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 1,
   "metadata": {
    "Collapsed": "false"
   },
   "outputs": [
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "==\n",
      "Logging in..\n",
      "Dimcli - Dimensions API Client (v0.7.2)\n",
      "Connected to: https://app.dimensions.ai - DSL v1.26\n",
      "Method: dsl.ini file\n"
     ]
    }
   ],
   "source": [
    "!pip install dimcli --quiet \n",
    "\n",
    "import dimcli\n",
    "from dimcli.shortcuts import *\n",
    "import json\n",
    "import sys\n",
    "import pandas as pd\n",
    "\n",
    "print(\"==\\nLogging in..\")\n",
    "# https://github.com/digital-science/dimcli#authentication\n",
    "ENDPOINT = \"https://app.dimensions.ai\"\n",
    "if 'google.colab' in sys.modules:\n",
    "  import getpass\n",
    "  USERNAME = getpass.getpass(prompt='Username: ')\n",
    "  PASSWORD = getpass.getpass(prompt='Password: ')    \n",
    "  dimcli.login(USERNAME, PASSWORD, ENDPOINT)\n",
    "else:\n",
    "  USERNAME, PASSWORD  = \"\", \"\"\n",
    "  dimcli.login(USERNAME, PASSWORD, ENDPOINT)\n",
    "dsl = dimcli.Dsl()"
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {
    "Collapsed": "false"
   },
   "source": [
    "## Step 1: Concept Extraction\n",
    "\n",
    "Extracting concepts is implemented using the [extract_concepts DSL function](https://docs.dimensions.ai/dsl/functions.html#function-extract-concepts). This is the syntax:\n",
    "```\n",
    "extract_concepts(\"publication abstract\")\n",
    "```\n",
    "\n",
    "This query will return a list of extracted concepts, ordered by weight, in descending order. For example:"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 2,
   "metadata": {
    "Collapsed": "false"
   },
   "outputs": [
    {
     "data": {
      "text/html": [
       "<div>\n",
       "<style scoped>\n",
       "    .dataframe tbody tr th:only-of-type {\n",
       "        vertical-align: middle;\n",
       "    }\n",
       "\n",
       "    .dataframe tbody tr th {\n",
       "        vertical-align: top;\n",
       "    }\n",
       "\n",
       "    .dataframe thead th {\n",
       "        text-align: right;\n",
       "    }\n",
       "</style>\n",
       "<table border=\"1\" class=\"dataframe\">\n",
       "  <thead>\n",
       "    <tr style=\"text-align: right;\">\n",
       "      <th></th>\n",
       "      <th>0</th>\n",
       "    </tr>\n",
       "  </thead>\n",
       "  <tbody>\n",
       "    <tr>\n",
       "      <th>0</th>\n",
       "      <td>ambipolar electric field effect</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>1</th>\n",
       "      <td>two-dimensional semimetal</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>2</th>\n",
       "      <td>room-temperature mobility</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>3</th>\n",
       "      <td>electric field effects</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>4</th>\n",
       "      <td>field effects</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>5</th>\n",
       "      <td>graphitic films</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>6</th>\n",
       "      <td>gate voltage</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>7</th>\n",
       "      <td>conductance band</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>8</th>\n",
       "      <td>square centimeter</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>9</th>\n",
       "      <td>films</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>10</th>\n",
       "      <td>electrons</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>11</th>\n",
       "      <td>semimetals</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>12</th>\n",
       "      <td>ambient conditions</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>13</th>\n",
       "      <td>atoms</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>14</th>\n",
       "      <td>holes</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>15</th>\n",
       "      <td>centimeters</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>16</th>\n",
       "      <td>metallic</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>17</th>\n",
       "      <td>voltage</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>18</th>\n",
       "      <td>band</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>19</th>\n",
       "      <td>high quality</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>20</th>\n",
       "      <td>valence</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>21</th>\n",
       "      <td>mobility</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>22</th>\n",
       "      <td>overlap</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>23</th>\n",
       "      <td>effect</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>24</th>\n",
       "      <td>conditions</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>25</th>\n",
       "      <td>concentration</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>26</th>\n",
       "      <td>quality</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>27</th>\n",
       "      <td>monocrystalline graphitic films</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>28</th>\n",
       "      <td>tiny overlap</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>29</th>\n",
       "      <td>strong ambipolar electric field effect</td>\n",
       "    </tr>\n",
       "  </tbody>\n",
       "</table>\n",
       "</div>"
      ],
      "text/plain": [
       "                                         0\n",
       "0          ambipolar electric field effect\n",
       "1                two-dimensional semimetal\n",
       "2                room-temperature mobility\n",
       "3                   electric field effects\n",
       "4                            field effects\n",
       "5                          graphitic films\n",
       "6                             gate voltage\n",
       "7                         conductance band\n",
       "8                        square centimeter\n",
       "9                                    films\n",
       "10                               electrons\n",
       "11                              semimetals\n",
       "12                      ambient conditions\n",
       "13                                   atoms\n",
       "14                                   holes\n",
       "15                             centimeters\n",
       "16                                metallic\n",
       "17                                 voltage\n",
       "18                                    band\n",
       "19                            high quality\n",
       "20                                 valence\n",
       "21                                mobility\n",
       "22                                 overlap\n",
       "23                                  effect\n",
       "24                              conditions\n",
       "25                           concentration\n",
       "26                                 quality\n",
       "27         monocrystalline graphitic films\n",
       "28                            tiny overlap\n",
       "29  strong ambipolar electric field effect"
      ]
     },
     "execution_count": 2,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "abstract = \"\"\"We describe monocrystalline graphitic films, which are a few atoms thick but are nonetheless stable under ambient conditions, \n",
    "metallic, and of remarkably high quality. The films are found to be a two-dimensional semimetal with a tiny overlap between \n",
    "valence and conductance bands, and they exhibit a strong ambipolar electric field effect such that electrons and \n",
    "holes in concentrations up to 10 per square centimeter and with room-temperature mobilities of approximately 10,000 square \n",
    "centimeters per volt-second can be induced by applying gate voltage.\n",
    "\"\"\"\n",
    "abstract = abstract.replace(\"\\n\", \" \")\n",
    "res = dsl.query(f\"\"\"extract_concepts(\"{abstract}\")\"\"\")\n",
    "CONCEPTS = res['extracted_concepts']\n",
    "pd.DataFrame(CONCEPTS)"
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {
    "Collapsed": "false"
   },
   "source": [
    "## Step 2: Expert Identification\n",
    "\n",
    "Extracted concepts, from step one, can be used in a `identify experts` queries, for example:\n",
    "\n",
    "```\n",
    "identify experts from concepts \"+malaria OR \\\"effective malaria vaccine\\\" OR \\\"effective prevention\\\"\"\n",
    "      using publications\n",
    "      where research_org_countries is not empty\n",
    "          and year >= 2013\n",
    "return experts[basics]\n",
    "      limit 20 skip 0\n",
    "      annotate organizational, coauthorship overlap\n",
    "          with [\"ur.016204724721.35\", \"ur.012127355561.32\"]\n",
    "```\n",
    "\n",
    "Returned experts are ordered by their **relevance**.\n",
    "\n",
    "**Important things to remember**:\n",
    "\n",
    "1. Experts identification can be executed on `publications` only at the moment (`grants` source will be added in the future). \n",
    "    * the phrase ``using publications`` may be omitted, as the `publications` source is used by default.\n",
    "    * For maximum compatibility with the expert identification workflow in the Dimensions UI, it is recommended to use the **two basic filters** shown in the example above, specifically `research_org_countries is not empty and year >= 2013`. \n",
    "1. When multiple concepts are provided, these are transformed automatically into an ``AND`` query. To match any of the concepts, one should then explicitly add ``OR`` connectors. \n",
    "3. It is possible to specify `where-filters` but that's not required. Fields available for filtering are exactly the same as the ones in standard `search` expressions.\n",
    "4. Similarly, the `paging-phrase` is optional. By default, the top 20 experts get returned - using limit/skip it is possible up to a maximum of 200.\n",
    "5. Annotating results with organizational and/or coauthorship overlap will produce another JSON object for each identified expert. This object has two parts.\n",
    "    * The **Organizational** overlap is defined as a boolean value that is true if the expert and the researchers from the query have the same current research organization.\n",
    "    * The **Coauthorship** conflict is defined as the number documents the expert has coauthored with any of the researchers provided in the query, in the last three years.\n"
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {
    "Collapsed": "false"
   },
   "source": [
    "### Example 1. Most Basic Query using `concepts`"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 3,
   "metadata": {
    "Collapsed": "false"
   },
   "outputs": [
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "Query:\n",
      "====== \n",
      "        identify experts \n",
      "            from concepts \"\\\"ambipolar electric field effect\\\" \\\"two-dimensional semimetal\\\" \\\"room-temperature mobility\\\" \\\"electric field effects\\\" \\\"field effects\\\" \\\"graphitic films\\\" \\\"gate voltage\\\" \\\"conductance band\\\" \\\"square centimeter\\\" \\\"films\\\" \\\"electrons\\\" \\\"semimetals\\\" \\\"ambient conditions\\\" \\\"atoms\\\" \\\"holes\\\"\"\n",
      "        return experts\n",
      "        \n"
     ]
    },
    {
     "data": {
      "text/html": [
       "<div>\n",
       "<style scoped>\n",
       "    .dataframe tbody tr th:only-of-type {\n",
       "        vertical-align: middle;\n",
       "    }\n",
       "\n",
       "    .dataframe tbody tr th {\n",
       "        vertical-align: top;\n",
       "    }\n",
       "\n",
       "    .dataframe thead th {\n",
       "        text-align: right;\n",
       "    }\n",
       "</style>\n",
       "<table border=\"1\" class=\"dataframe\">\n",
       "  <thead>\n",
       "    <tr style=\"text-align: right;\">\n",
       "      <th></th>\n",
       "      <th>id</th>\n",
       "      <th>score</th>\n",
       "      <th>research_orgs</th>\n",
       "      <th>last_name</th>\n",
       "      <th>first_name</th>\n",
       "      <th>docs_found</th>\n",
       "      <th>orcid_id</th>\n",
       "    </tr>\n",
       "  </thead>\n",
       "  <tbody>\n",
       "    <tr>\n",
       "      <th>0</th>\n",
       "      <td>ur.011033016243.08</td>\n",
       "      <td>7.87576</td>\n",
       "      <td>[grid.4886.2, grid.424048.e, grid.425037.7, gr...</td>\n",
       "      <td>Firsov</td>\n",
       "      <td>Anatoly A</td>\n",
       "      <td>1</td>\n",
       "      <td>NaN</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>1</th>\n",
       "      <td>ur.01146544531.57</td>\n",
       "      <td>7.87576</td>\n",
       "      <td>[grid.5379.8]</td>\n",
       "      <td>Jiang</td>\n",
       "      <td>Da</td>\n",
       "      <td>1</td>\n",
       "      <td>NaN</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>2</th>\n",
       "      <td>ur.011535264111.51</td>\n",
       "      <td>7.87576</td>\n",
       "      <td>[grid.4886.2, grid.5379.8, grid.5254.6, grid.5...</td>\n",
       "      <td>Dubonos</td>\n",
       "      <td>Sergey V</td>\n",
       "      <td>1</td>\n",
       "      <td>NaN</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>3</th>\n",
       "      <td>ur.01207120103.29</td>\n",
       "      <td>7.87576</td>\n",
       "      <td>[grid.5379.8, grid.425037.7, grid.116068.8, gr...</td>\n",
       "      <td>Novoselov</td>\n",
       "      <td>Konstantin Sergeevich</td>\n",
       "      <td>1</td>\n",
       "      <td>[0000-0003-4972-5371]</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>4</th>\n",
       "      <td>ur.0657076451.24</td>\n",
       "      <td>7.87576</td>\n",
       "      <td>[grid.8547.e, grid.5386.8, grid.184769.5, grid...</td>\n",
       "      <td>Zhang</td>\n",
       "      <td>Yuanbo</td>\n",
       "      <td>1</td>\n",
       "      <td>NaN</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>5</th>\n",
       "      <td>ur.0721730631.45</td>\n",
       "      <td>7.87576</td>\n",
       "      <td>[grid.7340.0, grid.5254.6, grid.418975.6, grid...</td>\n",
       "      <td>Geim</td>\n",
       "      <td>Andre Konstantin</td>\n",
       "      <td>1</td>\n",
       "      <td>[0000-0003-2861-8331]</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>6</th>\n",
       "      <td>ur.07423561367.62</td>\n",
       "      <td>7.87576</td>\n",
       "      <td>[grid.4886.2, grid.425081.a, grid.28171.3d, gr...</td>\n",
       "      <td>Morozov</td>\n",
       "      <td>Sergey V</td>\n",
       "      <td>1</td>\n",
       "      <td>[0000-0003-3075-7787]</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>7</th>\n",
       "      <td>ur.0767105504.29</td>\n",
       "      <td>7.87576</td>\n",
       "      <td>[grid.4886.2, grid.7340.0, grid.5337.2, grid.4...</td>\n",
       "      <td>Grigorieva</td>\n",
       "      <td>Irina V</td>\n",
       "      <td>1</td>\n",
       "      <td>[0000-0001-5991-7778]</td>\n",
       "    </tr>\n",
       "  </tbody>\n",
       "</table>\n",
       "</div>"
      ],
      "text/plain": [
       "                   id    score  \\\n",
       "0  ur.011033016243.08  7.87576   \n",
       "1   ur.01146544531.57  7.87576   \n",
       "2  ur.011535264111.51  7.87576   \n",
       "3   ur.01207120103.29  7.87576   \n",
       "4    ur.0657076451.24  7.87576   \n",
       "5    ur.0721730631.45  7.87576   \n",
       "6   ur.07423561367.62  7.87576   \n",
       "7    ur.0767105504.29  7.87576   \n",
       "\n",
       "                                       research_orgs   last_name  \\\n",
       "0  [grid.4886.2, grid.424048.e, grid.425037.7, gr...      Firsov   \n",
       "1                                      [grid.5379.8]       Jiang   \n",
       "2  [grid.4886.2, grid.5379.8, grid.5254.6, grid.5...     Dubonos   \n",
       "3  [grid.5379.8, grid.425037.7, grid.116068.8, gr...   Novoselov   \n",
       "4  [grid.8547.e, grid.5386.8, grid.184769.5, grid...       Zhang   \n",
       "5  [grid.7340.0, grid.5254.6, grid.418975.6, grid...        Geim   \n",
       "6  [grid.4886.2, grid.425081.a, grid.28171.3d, gr...     Morozov   \n",
       "7  [grid.4886.2, grid.7340.0, grid.5337.2, grid.4...  Grigorieva   \n",
       "\n",
       "              first_name  docs_found               orcid_id  \n",
       "0              Anatoly A           1                    NaN  \n",
       "1                     Da           1                    NaN  \n",
       "2               Sergey V           1                    NaN  \n",
       "3  Konstantin Sergeevich           1  [0000-0003-4972-5371]  \n",
       "4                 Yuanbo           1                    NaN  \n",
       "5       Andre Konstantin           1  [0000-0003-2861-8331]  \n",
       "6               Sergey V           1  [0000-0003-3075-7787]  \n",
       "7                Irina V           1  [0000-0001-5991-7778]  "
      ]
     },
     "execution_count": 3,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "some_concepts = \" \".join(['\"%s\"' % x for x in CONCEPTS[:15]])\n",
    "\n",
    "q = f\"\"\"\n",
    "        identify experts \n",
    "            from concepts \"{dsl_escape(some_concepts)}\"\n",
    "        return experts\n",
    "        \"\"\"\n",
    "\n",
    "print(\"Query:\\n======\", q)\n",
    "\n",
    "dsl.query(q).as_dataframe()\n"
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {
    "Collapsed": "false"
   },
   "source": [
    "### Example 2. Query with `OR` connectors\n",
    "\n",
    "Note: this time we return all experts fields by using the syntax `experts[all]`."
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 4,
   "metadata": {
    "Collapsed": "false"
   },
   "outputs": [
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "Query:\n",
      "====== \n",
      "        identify experts \n",
      "            from concepts \"\\\"ambipolar electric field effect\\\" OR \\\"two-dimensional semimetal\\\" OR \\\"room-temperature mobility\\\" OR \\\"electric field effects\\\" OR \\\"field effects\\\" OR \\\"graphitic films\\\" OR \\\"gate voltage\\\" OR \\\"conductance band\\\" OR \\\"square centimeter\\\" OR \\\"films\\\" OR \\\"electrons\\\" OR \\\"semimetals\\\" OR \\\"ambient conditions\\\" OR \\\"atoms\\\" OR \\\"holes\\\"\"\n",
      "        return experts[all]\n",
      "        \n"
     ]
    },
    {
     "data": {
      "text/html": [
       "<div>\n",
       "<style scoped>\n",
       "    .dataframe tbody tr th:only-of-type {\n",
       "        vertical-align: middle;\n",
       "    }\n",
       "\n",
       "    .dataframe tbody tr th {\n",
       "        vertical-align: top;\n",
       "    }\n",
       "\n",
       "    .dataframe thead th {\n",
       "        text-align: right;\n",
       "    }\n",
       "</style>\n",
       "<table border=\"1\" class=\"dataframe\">\n",
       "  <thead>\n",
       "    <tr style=\"text-align: right;\">\n",
       "      <th></th>\n",
       "      <th>id</th>\n",
       "      <th>score</th>\n",
       "      <th>research_orgs</th>\n",
       "      <th>orcid_id</th>\n",
       "      <th>total_grants</th>\n",
       "      <th>last_grant_year</th>\n",
       "      <th>obsolete</th>\n",
       "      <th>last_name</th>\n",
       "      <th>total_publications</th>\n",
       "      <th>first_publication_year</th>\n",
       "      <th>last_publication_year</th>\n",
       "      <th>current_research_org</th>\n",
       "      <th>first_name</th>\n",
       "      <th>first_grant_year</th>\n",
       "      <th>docs_found</th>\n",
       "    </tr>\n",
       "  </thead>\n",
       "  <tbody>\n",
       "    <tr>\n",
       "      <th>0</th>\n",
       "      <td>ur.01207120103.29</td>\n",
       "      <td>8.406035</td>\n",
       "      <td>[grid.5379.8, grid.425037.7, grid.116068.8, gr...</td>\n",
       "      <td>[0000-0003-4972-5371]</td>\n",
       "      <td>11</td>\n",
       "      <td>2023.0</td>\n",
       "      <td>0</td>\n",
       "      <td>Novoselov</td>\n",
       "      <td>590</td>\n",
       "      <td>1997</td>\n",
       "      <td>2020</td>\n",
       "      <td>grid.5379.8</td>\n",
       "      <td>Konstantin Sergeevich</td>\n",
       "      <td>2006.0</td>\n",
       "      <td>3</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>1</th>\n",
       "      <td>ur.0721730631.45</td>\n",
       "      <td>8.406035</td>\n",
       "      <td>[grid.7340.0, grid.5254.6, grid.418975.6, grid...</td>\n",
       "      <td>[0000-0003-2861-8331]</td>\n",
       "      <td>10</td>\n",
       "      <td>2024.0</td>\n",
       "      <td>0</td>\n",
       "      <td>Geim</td>\n",
       "      <td>582</td>\n",
       "      <td>1991</td>\n",
       "      <td>2020</td>\n",
       "      <td>grid.5379.8</td>\n",
       "      <td>Andre Konstantin</td>\n",
       "      <td>2006.0</td>\n",
       "      <td>3</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>2</th>\n",
       "      <td>ur.07423561367.62</td>\n",
       "      <td>8.406035</td>\n",
       "      <td>[grid.4886.2, grid.425081.a, grid.28171.3d, gr...</td>\n",
       "      <td>[0000-0003-3075-7787]</td>\n",
       "      <td>6</td>\n",
       "      <td>2021.0</td>\n",
       "      <td>0</td>\n",
       "      <td>Morozov</td>\n",
       "      <td>269</td>\n",
       "      <td>1990</td>\n",
       "      <td>2020</td>\n",
       "      <td>grid.425081.a</td>\n",
       "      <td>Sergey V</td>\n",
       "      <td>2013.0</td>\n",
       "      <td>3</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>3</th>\n",
       "      <td>ur.0657076451.24</td>\n",
       "      <td>8.355439</td>\n",
       "      <td>[grid.8547.e, grid.5386.8, grid.184769.5, grid...</td>\n",
       "      <td>NaN</td>\n",
       "      <td>0</td>\n",
       "      <td>NaN</td>\n",
       "      <td>0</td>\n",
       "      <td>Zhang</td>\n",
       "      <td>74</td>\n",
       "      <td>2004</td>\n",
       "      <td>2019</td>\n",
       "      <td>grid.8547.e</td>\n",
       "      <td>Yuanbo</td>\n",
       "      <td>NaN</td>\n",
       "      <td>2</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>4</th>\n",
       "      <td>ur.011033016243.08</td>\n",
       "      <td>8.081146</td>\n",
       "      <td>[grid.4886.2, grid.424048.e, grid.425037.7, gr...</td>\n",
       "      <td>NaN</td>\n",
       "      <td>0</td>\n",
       "      <td>NaN</td>\n",
       "      <td>0</td>\n",
       "      <td>Firsov</td>\n",
       "      <td>25</td>\n",
       "      <td>2003</td>\n",
       "      <td>2018</td>\n",
       "      <td>grid.424048.e</td>\n",
       "      <td>Anatoly A</td>\n",
       "      <td>NaN</td>\n",
       "      <td>2</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>5</th>\n",
       "      <td>ur.01146544531.57</td>\n",
       "      <td>8.081146</td>\n",
       "      <td>[grid.5379.8]</td>\n",
       "      <td>NaN</td>\n",
       "      <td>0</td>\n",
       "      <td>NaN</td>\n",
       "      <td>0</td>\n",
       "      <td>Jiang</td>\n",
       "      <td>11</td>\n",
       "      <td>2004</td>\n",
       "      <td>2008</td>\n",
       "      <td>grid.5379.8</td>\n",
       "      <td>Da</td>\n",
       "      <td>NaN</td>\n",
       "      <td>2</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>6</th>\n",
       "      <td>ur.011535264111.51</td>\n",
       "      <td>7.875760</td>\n",
       "      <td>[grid.4886.2, grid.5379.8, grid.5254.6, grid.5...</td>\n",
       "      <td>NaN</td>\n",
       "      <td>0</td>\n",
       "      <td>NaN</td>\n",
       "      <td>0</td>\n",
       "      <td>Dubonos</td>\n",
       "      <td>81</td>\n",
       "      <td>1990</td>\n",
       "      <td>2009</td>\n",
       "      <td>grid.425037.7</td>\n",
       "      <td>Sergey V</td>\n",
       "      <td>NaN</td>\n",
       "      <td>1</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>7</th>\n",
       "      <td>ur.0767105504.29</td>\n",
       "      <td>7.875760</td>\n",
       "      <td>[grid.4886.2, grid.7340.0, grid.5337.2, grid.4...</td>\n",
       "      <td>[0000-0001-5991-7778]</td>\n",
       "      <td>4</td>\n",
       "      <td>2021.0</td>\n",
       "      <td>0</td>\n",
       "      <td>Grigorieva</td>\n",
       "      <td>158</td>\n",
       "      <td>1989</td>\n",
       "      <td>2020</td>\n",
       "      <td>grid.5379.8</td>\n",
       "      <td>Irina V</td>\n",
       "      <td>2007.0</td>\n",
       "      <td>1</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>8</th>\n",
       "      <td>ur.011513332561.53</td>\n",
       "      <td>5.697777</td>\n",
       "      <td>[grid.39158.36, grid.260539.b, grid.69566.3a]</td>\n",
       "      <td>NaN</td>\n",
       "      <td>23</td>\n",
       "      <td>2011.0</td>\n",
       "      <td>0</td>\n",
       "      <td>Ohta</td>\n",
       "      <td>208</td>\n",
       "      <td>1976</td>\n",
       "      <td>2020</td>\n",
       "      <td>grid.260539.b</td>\n",
       "      <td>Nobuhiro</td>\n",
       "      <td>1987.0</td>\n",
       "      <td>21</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>9</th>\n",
       "      <td>ur.01055006635.53</td>\n",
       "      <td>3.264948</td>\n",
       "      <td>[grid.450314.7, grid.4605.7, grid.7727.5, grid...</td>\n",
       "      <td>NaN</td>\n",
       "      <td>12</td>\n",
       "      <td>2011.0</td>\n",
       "      <td>0</td>\n",
       "      <td>Kvon</td>\n",
       "      <td>326</td>\n",
       "      <td>1983</td>\n",
       "      <td>2020</td>\n",
       "      <td>grid.4605.7</td>\n",
       "      <td>Ze Don</td>\n",
       "      <td>1993.0</td>\n",
       "      <td>8</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>10</th>\n",
       "      <td>ur.013312524031.58</td>\n",
       "      <td>3.022535</td>\n",
       "      <td>[grid.443127.7, grid.420030.5, grid.419396.0, ...</td>\n",
       "      <td>NaN</td>\n",
       "      <td>28</td>\n",
       "      <td>2003.0</td>\n",
       "      <td>0</td>\n",
       "      <td>Yamazaki</td>\n",
       "      <td>258</td>\n",
       "      <td>1966</td>\n",
       "      <td>2013</td>\n",
       "      <td>grid.39158.36</td>\n",
       "      <td>Iwao</td>\n",
       "      <td>1984.0</td>\n",
       "      <td>11</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>11</th>\n",
       "      <td>ur.01203703171.12</td>\n",
       "      <td>2.642304</td>\n",
       "      <td>[grid.26999.3d, grid.69566.3a, grid.472717.0, ...</td>\n",
       "      <td>[0000-0002-6631-5131]</td>\n",
       "      <td>11</td>\n",
       "      <td>2022.0</td>\n",
       "      <td>0</td>\n",
       "      <td>Chiba</td>\n",
       "      <td>208</td>\n",
       "      <td>2000</td>\n",
       "      <td>2020</td>\n",
       "      <td>grid.136593.b</td>\n",
       "      <td>Daichi</td>\n",
       "      <td>2009.0</td>\n",
       "      <td>9</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>12</th>\n",
       "      <td>ur.0740560235.48</td>\n",
       "      <td>2.564912</td>\n",
       "      <td>[grid.4886.2, grid.15276.37, grid.11899.38, gr...</td>\n",
       "      <td>NaN</td>\n",
       "      <td>0</td>\n",
       "      <td>NaN</td>\n",
       "      <td>0</td>\n",
       "      <td>Olshanetsky</td>\n",
       "      <td>91</td>\n",
       "      <td>1989</td>\n",
       "      <td>2020</td>\n",
       "      <td>grid.450314.7</td>\n",
       "      <td>Eugene</td>\n",
       "      <td>NaN</td>\n",
       "      <td>6</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>13</th>\n",
       "      <td>ur.01034030721.03</td>\n",
       "      <td>2.516857</td>\n",
       "      <td>[grid.5338.d, grid.116068.8, grid.21941.3f, gr...</td>\n",
       "      <td>[0000-0001-8217-8213]</td>\n",
       "      <td>7</td>\n",
       "      <td>2023.0</td>\n",
       "      <td>0</td>\n",
       "      <td>Jarillo-Herrero</td>\n",
       "      <td>233</td>\n",
       "      <td>2000</td>\n",
       "      <td>2020</td>\n",
       "      <td>grid.116068.8</td>\n",
       "      <td>Pablo</td>\n",
       "      <td>2009.0</td>\n",
       "      <td>5</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>14</th>\n",
       "      <td>ur.01340766601.27</td>\n",
       "      <td>1.758987</td>\n",
       "      <td>[grid.469490.6, grid.432790.b, grid.431860.8, ...</td>\n",
       "      <td>NaN</td>\n",
       "      <td>6</td>\n",
       "      <td>2009.0</td>\n",
       "      <td>0</td>\n",
       "      <td>Venkatesan</td>\n",
       "      <td>777</td>\n",
       "      <td>1975</td>\n",
       "      <td>2020</td>\n",
       "      <td>grid.4280.e</td>\n",
       "      <td>Thirumalai Venky</td>\n",
       "      <td>1984.0</td>\n",
       "      <td>6</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>15</th>\n",
       "      <td>ur.011775522057.45</td>\n",
       "      <td>1.718926</td>\n",
       "      <td>[grid.448924.7, grid.450314.7, grid.4605.7, gr...</td>\n",
       "      <td>NaN</td>\n",
       "      <td>0</td>\n",
       "      <td>NaN</td>\n",
       "      <td>0</td>\n",
       "      <td>Mikhailov</td>\n",
       "      <td>222</td>\n",
       "      <td>1995</td>\n",
       "      <td>2020</td>\n",
       "      <td>grid.450314.7</td>\n",
       "      <td>Nikolay N</td>\n",
       "      <td>NaN</td>\n",
       "      <td>5</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>16</th>\n",
       "      <td>ur.01024676171.26</td>\n",
       "      <td>1.649508</td>\n",
       "      <td>[grid.5801.c, grid.481554.9, grid.410387.9, gr...</td>\n",
       "      <td>NaN</td>\n",
       "      <td>0</td>\n",
       "      <td>NaN</td>\n",
       "      <td>0</td>\n",
       "      <td>Bednorz</td>\n",
       "      <td>129</td>\n",
       "      <td>1976</td>\n",
       "      <td>2017</td>\n",
       "      <td>grid.410387.9</td>\n",
       "      <td>Johannes Georg</td>\n",
       "      <td>NaN</td>\n",
       "      <td>4</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>17</th>\n",
       "      <td>ur.01267137567.67</td>\n",
       "      <td>1.649508</td>\n",
       "      <td>[grid.410387.9, grid.7307.3, grid.10392.39, gr...</td>\n",
       "      <td>[0000-0001-6331-2640]</td>\n",
       "      <td>7</td>\n",
       "      <td>2020.0</td>\n",
       "      <td>0</td>\n",
       "      <td>Mannhart</td>\n",
       "      <td>358</td>\n",
       "      <td>1986</td>\n",
       "      <td>2020</td>\n",
       "      <td>grid.419552.e</td>\n",
       "      <td>Jochen D</td>\n",
       "      <td>1990.0</td>\n",
       "      <td>4</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>18</th>\n",
       "      <td>ur.07376375471.82</td>\n",
       "      <td>1.637159</td>\n",
       "      <td>[grid.4886.2, grid.4605.7, grid.7727.5, grid.4...</td>\n",
       "      <td>NaN</td>\n",
       "      <td>2</td>\n",
       "      <td>2019.0</td>\n",
       "      <td>0</td>\n",
       "      <td>Kozlov</td>\n",
       "      <td>52</td>\n",
       "      <td>2007</td>\n",
       "      <td>2020</td>\n",
       "      <td>grid.450314.7</td>\n",
       "      <td>Dmitriy A</td>\n",
       "      <td>2014.0</td>\n",
       "      <td>4</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>19</th>\n",
       "      <td>ur.07410612715.77</td>\n",
       "      <td>1.631930</td>\n",
       "      <td>[grid.24434.35, grid.39158.36, grid.20515.33, ...</td>\n",
       "      <td>[0000-0002-9982-141X]</td>\n",
       "      <td>15</td>\n",
       "      <td>2008.0</td>\n",
       "      <td>0</td>\n",
       "      <td>Nishimura</td>\n",
       "      <td>173</td>\n",
       "      <td>1987</td>\n",
       "      <td>2020</td>\n",
       "      <td>grid.20515.33</td>\n",
       "      <td>Yoshinobu</td>\n",
       "      <td>1989.0</td>\n",
       "      <td>5</td>\n",
       "    </tr>\n",
       "  </tbody>\n",
       "</table>\n",
       "</div>"
      ],
      "text/plain": [
       "                    id     score  \\\n",
       "0    ur.01207120103.29  8.406035   \n",
       "1     ur.0721730631.45  8.406035   \n",
       "2    ur.07423561367.62  8.406035   \n",
       "3     ur.0657076451.24  8.355439   \n",
       "4   ur.011033016243.08  8.081146   \n",
       "5    ur.01146544531.57  8.081146   \n",
       "6   ur.011535264111.51  7.875760   \n",
       "7     ur.0767105504.29  7.875760   \n",
       "8   ur.011513332561.53  5.697777   \n",
       "9    ur.01055006635.53  3.264948   \n",
       "10  ur.013312524031.58  3.022535   \n",
       "11   ur.01203703171.12  2.642304   \n",
       "12    ur.0740560235.48  2.564912   \n",
       "13   ur.01034030721.03  2.516857   \n",
       "14   ur.01340766601.27  1.758987   \n",
       "15  ur.011775522057.45  1.718926   \n",
       "16   ur.01024676171.26  1.649508   \n",
       "17   ur.01267137567.67  1.649508   \n",
       "18   ur.07376375471.82  1.637159   \n",
       "19   ur.07410612715.77  1.631930   \n",
       "\n",
       "                                        research_orgs               orcid_id  \\\n",
       "0   [grid.5379.8, grid.425037.7, grid.116068.8, gr...  [0000-0003-4972-5371]   \n",
       "1   [grid.7340.0, grid.5254.6, grid.418975.6, grid...  [0000-0003-2861-8331]   \n",
       "2   [grid.4886.2, grid.425081.a, grid.28171.3d, gr...  [0000-0003-3075-7787]   \n",
       "3   [grid.8547.e, grid.5386.8, grid.184769.5, grid...                    NaN   \n",
       "4   [grid.4886.2, grid.424048.e, grid.425037.7, gr...                    NaN   \n",
       "5                                       [grid.5379.8]                    NaN   \n",
       "6   [grid.4886.2, grid.5379.8, grid.5254.6, grid.5...                    NaN   \n",
       "7   [grid.4886.2, grid.7340.0, grid.5337.2, grid.4...  [0000-0001-5991-7778]   \n",
       "8       [grid.39158.36, grid.260539.b, grid.69566.3a]                    NaN   \n",
       "9   [grid.450314.7, grid.4605.7, grid.7727.5, grid...                    NaN   \n",
       "10  [grid.443127.7, grid.420030.5, grid.419396.0, ...                    NaN   \n",
       "11  [grid.26999.3d, grid.69566.3a, grid.472717.0, ...  [0000-0002-6631-5131]   \n",
       "12  [grid.4886.2, grid.15276.37, grid.11899.38, gr...                    NaN   \n",
       "13  [grid.5338.d, grid.116068.8, grid.21941.3f, gr...  [0000-0001-8217-8213]   \n",
       "14  [grid.469490.6, grid.432790.b, grid.431860.8, ...                    NaN   \n",
       "15  [grid.448924.7, grid.450314.7, grid.4605.7, gr...                    NaN   \n",
       "16  [grid.5801.c, grid.481554.9, grid.410387.9, gr...                    NaN   \n",
       "17  [grid.410387.9, grid.7307.3, grid.10392.39, gr...  [0000-0001-6331-2640]   \n",
       "18  [grid.4886.2, grid.4605.7, grid.7727.5, grid.4...                    NaN   \n",
       "19  [grid.24434.35, grid.39158.36, grid.20515.33, ...  [0000-0002-9982-141X]   \n",
       "\n",
       "    total_grants  last_grant_year  obsolete        last_name  \\\n",
       "0             11           2023.0         0        Novoselov   \n",
       "1             10           2024.0         0             Geim   \n",
       "2              6           2021.0         0          Morozov   \n",
       "3              0              NaN         0            Zhang   \n",
       "4              0              NaN         0           Firsov   \n",
       "5              0              NaN         0            Jiang   \n",
       "6              0              NaN         0          Dubonos   \n",
       "7              4           2021.0         0       Grigorieva   \n",
       "8             23           2011.0         0             Ohta   \n",
       "9             12           2011.0         0             Kvon   \n",
       "10            28           2003.0         0         Yamazaki   \n",
       "11            11           2022.0         0            Chiba   \n",
       "12             0              NaN         0      Olshanetsky   \n",
       "13             7           2023.0         0  Jarillo-Herrero   \n",
       "14             6           2009.0         0       Venkatesan   \n",
       "15             0              NaN         0        Mikhailov   \n",
       "16             0              NaN         0          Bednorz   \n",
       "17             7           2020.0         0         Mannhart   \n",
       "18             2           2019.0         0           Kozlov   \n",
       "19            15           2008.0         0        Nishimura   \n",
       "\n",
       "    total_publications  first_publication_year  last_publication_year  \\\n",
       "0                  590                    1997                   2020   \n",
       "1                  582                    1991                   2020   \n",
       "2                  269                    1990                   2020   \n",
       "3                   74                    2004                   2019   \n",
       "4                   25                    2003                   2018   \n",
       "5                   11                    2004                   2008   \n",
       "6                   81                    1990                   2009   \n",
       "7                  158                    1989                   2020   \n",
       "8                  208                    1976                   2020   \n",
       "9                  326                    1983                   2020   \n",
       "10                 258                    1966                   2013   \n",
       "11                 208                    2000                   2020   \n",
       "12                  91                    1989                   2020   \n",
       "13                 233                    2000                   2020   \n",
       "14                 777                    1975                   2020   \n",
       "15                 222                    1995                   2020   \n",
       "16                 129                    1976                   2017   \n",
       "17                 358                    1986                   2020   \n",
       "18                  52                    2007                   2020   \n",
       "19                 173                    1987                   2020   \n",
       "\n",
       "   current_research_org             first_name  first_grant_year  docs_found  \n",
       "0           grid.5379.8  Konstantin Sergeevich            2006.0           3  \n",
       "1           grid.5379.8       Andre Konstantin            2006.0           3  \n",
       "2         grid.425081.a               Sergey V            2013.0           3  \n",
       "3           grid.8547.e                 Yuanbo               NaN           2  \n",
       "4         grid.424048.e              Anatoly A               NaN           2  \n",
       "5           grid.5379.8                     Da               NaN           2  \n",
       "6         grid.425037.7               Sergey V               NaN           1  \n",
       "7           grid.5379.8                Irina V            2007.0           1  \n",
       "8         grid.260539.b               Nobuhiro            1987.0          21  \n",
       "9           grid.4605.7                 Ze Don            1993.0           8  \n",
       "10        grid.39158.36                   Iwao            1984.0          11  \n",
       "11        grid.136593.b                 Daichi            2009.0           9  \n",
       "12        grid.450314.7                 Eugene               NaN           6  \n",
       "13        grid.116068.8                  Pablo            2009.0           5  \n",
       "14          grid.4280.e       Thirumalai Venky            1984.0           6  \n",
       "15        grid.450314.7              Nikolay N               NaN           5  \n",
       "16        grid.410387.9         Johannes Georg               NaN           4  \n",
       "17        grid.419552.e               Jochen D            1990.0           4  \n",
       "18        grid.450314.7              Dmitriy A            2014.0           4  \n",
       "19        grid.20515.33              Yoshinobu            1989.0           5  "
      ]
     },
     "execution_count": 4,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "some_concepts = \" OR \".join(['\"%s\"' % x for x in CONCEPTS[:15]])\n",
    "\n",
    "q = f\"\"\"\n",
    "        identify experts \n",
    "            from concepts \"{dsl_escape(some_concepts)}\"\n",
    "        return experts[all]\n",
    "        \"\"\"\n",
    "\n",
    "print(\"Query:\\n======\", q)\n",
    "\n",
    "dsl.query(q).as_dataframe()\n"
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {
    "Collapsed": "false"
   },
   "source": [
    "### Example 3. Query with `where` filters\n",
    " "
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 5,
   "metadata": {
    "Collapsed": "false"
   },
   "outputs": [
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "Query:\n",
      "====== identify experts \n",
      "            from concepts \"\\\"ambipolar electric field effect\\\" \\\"two-dimensional semimetal\\\" \\\"room-temperature mobility\\\" \\\"electric field effects\\\" \\\"field effects\\\" \\\"graphitic films\\\" \\\"gate voltage\\\" \\\"conductance band\\\" \\\"square centimeter\\\" \\\"films\\\"\"\n",
      "            using publications\n",
      "            where research_org_countries is not empty\n",
      "              and year >= 2000\n",
      "              and times_cited > 100\n",
      "        return experts\n",
      "        \n"
     ]
    },
    {
     "data": {
      "text/html": [
       "<div>\n",
       "<style scoped>\n",
       "    .dataframe tbody tr th:only-of-type {\n",
       "        vertical-align: middle;\n",
       "    }\n",
       "\n",
       "    .dataframe tbody tr th {\n",
       "        vertical-align: top;\n",
       "    }\n",
       "\n",
       "    .dataframe thead th {\n",
       "        text-align: right;\n",
       "    }\n",
       "</style>\n",
       "<table border=\"1\" class=\"dataframe\">\n",
       "  <thead>\n",
       "    <tr style=\"text-align: right;\">\n",
       "      <th></th>\n",
       "      <th>id</th>\n",
       "      <th>score</th>\n",
       "      <th>first_name</th>\n",
       "      <th>research_orgs</th>\n",
       "      <th>last_name</th>\n",
       "      <th>docs_found</th>\n",
       "      <th>orcid_id</th>\n",
       "    </tr>\n",
       "  </thead>\n",
       "  <tbody>\n",
       "    <tr>\n",
       "      <th>0</th>\n",
       "      <td>ur.011033016243.08</td>\n",
       "      <td>7.383875</td>\n",
       "      <td>Anatoly A</td>\n",
       "      <td>[grid.4886.2, grid.424048.e, grid.425037.7, gr...</td>\n",
       "      <td>Firsov</td>\n",
       "      <td>1</td>\n",
       "      <td>NaN</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>1</th>\n",
       "      <td>ur.01146544531.57</td>\n",
       "      <td>7.383875</td>\n",
       "      <td>Da</td>\n",
       "      <td>[grid.5379.8]</td>\n",
       "      <td>Jiang</td>\n",
       "      <td>1</td>\n",
       "      <td>NaN</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>2</th>\n",
       "      <td>ur.011535264111.51</td>\n",
       "      <td>7.383875</td>\n",
       "      <td>Sergey V</td>\n",
       "      <td>[grid.4886.2, grid.5379.8, grid.5254.6, grid.5...</td>\n",
       "      <td>Dubonos</td>\n",
       "      <td>1</td>\n",
       "      <td>NaN</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>3</th>\n",
       "      <td>ur.01207120103.29</td>\n",
       "      <td>7.383875</td>\n",
       "      <td>Konstantin Sergeevich</td>\n",
       "      <td>[grid.5379.8, grid.425037.7, grid.116068.8, gr...</td>\n",
       "      <td>Novoselov</td>\n",
       "      <td>1</td>\n",
       "      <td>[0000-0003-4972-5371]</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>4</th>\n",
       "      <td>ur.0657076451.24</td>\n",
       "      <td>7.383875</td>\n",
       "      <td>Yuanbo</td>\n",
       "      <td>[grid.8547.e, grid.5386.8, grid.184769.5, grid...</td>\n",
       "      <td>Zhang</td>\n",
       "      <td>1</td>\n",
       "      <td>NaN</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>5</th>\n",
       "      <td>ur.0721730631.45</td>\n",
       "      <td>7.383875</td>\n",
       "      <td>Andre Konstantin</td>\n",
       "      <td>[grid.7340.0, grid.5254.6, grid.418975.6, grid...</td>\n",
       "      <td>Geim</td>\n",
       "      <td>1</td>\n",
       "      <td>[0000-0003-2861-8331]</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>6</th>\n",
       "      <td>ur.07423561367.62</td>\n",
       "      <td>7.383875</td>\n",
       "      <td>Sergey V</td>\n",
       "      <td>[grid.4886.2, grid.425081.a, grid.28171.3d, gr...</td>\n",
       "      <td>Morozov</td>\n",
       "      <td>1</td>\n",
       "      <td>[0000-0003-3075-7787]</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>7</th>\n",
       "      <td>ur.0767105504.29</td>\n",
       "      <td>7.383875</td>\n",
       "      <td>Irina V</td>\n",
       "      <td>[grid.4886.2, grid.7340.0, grid.5337.2, grid.4...</td>\n",
       "      <td>Grigorieva</td>\n",
       "      <td>1</td>\n",
       "      <td>[0000-0001-5991-7778]</td>\n",
       "    </tr>\n",
       "  </tbody>\n",
       "</table>\n",
       "</div>"
      ],
      "text/plain": [
       "                   id     score             first_name  \\\n",
       "0  ur.011033016243.08  7.383875              Anatoly A   \n",
       "1   ur.01146544531.57  7.383875                     Da   \n",
       "2  ur.011535264111.51  7.383875               Sergey V   \n",
       "3   ur.01207120103.29  7.383875  Konstantin Sergeevich   \n",
       "4    ur.0657076451.24  7.383875                 Yuanbo   \n",
       "5    ur.0721730631.45  7.383875       Andre Konstantin   \n",
       "6   ur.07423561367.62  7.383875               Sergey V   \n",
       "7    ur.0767105504.29  7.383875                Irina V   \n",
       "\n",
       "                                       research_orgs   last_name  docs_found  \\\n",
       "0  [grid.4886.2, grid.424048.e, grid.425037.7, gr...      Firsov           1   \n",
       "1                                      [grid.5379.8]       Jiang           1   \n",
       "2  [grid.4886.2, grid.5379.8, grid.5254.6, grid.5...     Dubonos           1   \n",
       "3  [grid.5379.8, grid.425037.7, grid.116068.8, gr...   Novoselov           1   \n",
       "4  [grid.8547.e, grid.5386.8, grid.184769.5, grid...       Zhang           1   \n",
       "5  [grid.7340.0, grid.5254.6, grid.418975.6, grid...        Geim           1   \n",
       "6  [grid.4886.2, grid.425081.a, grid.28171.3d, gr...     Morozov           1   \n",
       "7  [grid.4886.2, grid.7340.0, grid.5337.2, grid.4...  Grigorieva           1   \n",
       "\n",
       "                orcid_id  \n",
       "0                    NaN  \n",
       "1                    NaN  \n",
       "2                    NaN  \n",
       "3  [0000-0003-4972-5371]  \n",
       "4                    NaN  \n",
       "5  [0000-0003-2861-8331]  \n",
       "6  [0000-0003-3075-7787]  \n",
       "7  [0000-0001-5991-7778]  "
      ]
     },
     "execution_count": 5,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "some_concepts = \" \".join(['\"%s\"' % x for x in CONCEPTS[:10]])\n",
    "\n",
    "q = f\"\"\"identify experts \n",
    "            from concepts \"{dsl_escape(some_concepts)}\"\n",
    "            using publications\n",
    "            where research_org_countries is not empty\n",
    "              and year >= 2000\n",
    "              and times_cited > 100\n",
    "        return experts\n",
    "        \"\"\"\n",
    "\n",
    "print(\"Query:\\n======\", q)\n",
    "\n",
    "dsl.query(q).as_dataframe()"
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {
    "Collapsed": "false"
   },
   "source": [
    "### Example 4. Adding Overlap Annotations  (eg for conflict of interests checks)\n"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 6,
   "metadata": {
    "Collapsed": "false"
   },
   "outputs": [
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "Query:\n",
      "====== \n",
      "        identify experts \n",
      "            from concepts \"\\\"ambipolar electric field effect\\\" \\\"two-dimensional semimetal\\\" \\\"room-temperature mobility\\\" \\\"electric field effects\\\" \\\"field effects\\\" \\\"graphitic films\\\" \\\"gate voltage\\\" \\\"conductance band\\\" \\\"square centimeter\\\" \\\"films\\\"\"\n",
      "            using publications\n",
      "            where research_org_countries is not empty\n",
      "              and year >= 2000\n",
      "        return experts\n",
      "            annotate coauthorship, organizational overlap\n",
      "            with [\"ur.011535264111.51\", \"ur.011033016243.08\", \"ur.01207120103.29\"]\n",
      "        \n"
     ]
    },
    {
     "data": {
      "text/html": [
       "<div>\n",
       "<style scoped>\n",
       "    .dataframe tbody tr th:only-of-type {\n",
       "        vertical-align: middle;\n",
       "    }\n",
       "\n",
       "    .dataframe tbody tr th {\n",
       "        vertical-align: top;\n",
       "    }\n",
       "\n",
       "    .dataframe thead th {\n",
       "        text-align: right;\n",
       "    }\n",
       "</style>\n",
       "<table border=\"1\" class=\"dataframe\">\n",
       "  <thead>\n",
       "    <tr style=\"text-align: right;\">\n",
       "      <th></th>\n",
       "      <th>id</th>\n",
       "      <th>score</th>\n",
       "      <th>first_name</th>\n",
       "      <th>research_orgs</th>\n",
       "      <th>last_name</th>\n",
       "      <th>docs_found</th>\n",
       "      <th>overlap.coauthorship</th>\n",
       "      <th>overlap.organizational</th>\n",
       "      <th>orcid_id</th>\n",
       "    </tr>\n",
       "  </thead>\n",
       "  <tbody>\n",
       "    <tr>\n",
       "      <th>0</th>\n",
       "      <td>ur.011033016243.08</td>\n",
       "      <td>7.382478</td>\n",
       "      <td>Anatoly A</td>\n",
       "      <td>[grid.4886.2, grid.424048.e, grid.425037.7, gr...</td>\n",
       "      <td>Firsov</td>\n",
       "      <td>1</td>\n",
       "      <td>3</td>\n",
       "      <td>True</td>\n",
       "      <td>NaN</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>1</th>\n",
       "      <td>ur.01146544531.57</td>\n",
       "      <td>7.382478</td>\n",
       "      <td>Da</td>\n",
       "      <td>[grid.5379.8]</td>\n",
       "      <td>Jiang</td>\n",
       "      <td>1</td>\n",
       "      <td>0</td>\n",
       "      <td>True</td>\n",
       "      <td>NaN</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>2</th>\n",
       "      <td>ur.011535264111.51</td>\n",
       "      <td>7.382478</td>\n",
       "      <td>Sergey V</td>\n",
       "      <td>[grid.4886.2, grid.5379.8, grid.5254.6, grid.5...</td>\n",
       "      <td>Dubonos</td>\n",
       "      <td>1</td>\n",
       "      <td>0</td>\n",
       "      <td>True</td>\n",
       "      <td>NaN</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>3</th>\n",
       "      <td>ur.01207120103.29</td>\n",
       "      <td>7.382478</td>\n",
       "      <td>Konstantin Sergeevich</td>\n",
       "      <td>[grid.5379.8, grid.425037.7, grid.116068.8, gr...</td>\n",
       "      <td>Novoselov</td>\n",
       "      <td>1</td>\n",
       "      <td>153</td>\n",
       "      <td>True</td>\n",
       "      <td>[0000-0003-4972-5371]</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>4</th>\n",
       "      <td>ur.0657076451.24</td>\n",
       "      <td>7.382478</td>\n",
       "      <td>Yuanbo</td>\n",
       "      <td>[grid.8547.e, grid.5386.8, grid.184769.5, grid...</td>\n",
       "      <td>Zhang</td>\n",
       "      <td>1</td>\n",
       "      <td>0</td>\n",
       "      <td>False</td>\n",
       "      <td>NaN</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>5</th>\n",
       "      <td>ur.0721730631.45</td>\n",
       "      <td>7.382478</td>\n",
       "      <td>Andre Konstantin</td>\n",
       "      <td>[grid.7340.0, grid.5254.6, grid.418975.6, grid...</td>\n",
       "      <td>Geim</td>\n",
       "      <td>1</td>\n",
       "      <td>38</td>\n",
       "      <td>True</td>\n",
       "      <td>[0000-0003-2861-8331]</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>6</th>\n",
       "      <td>ur.07423561367.62</td>\n",
       "      <td>7.382478</td>\n",
       "      <td>Sergey V</td>\n",
       "      <td>[grid.4886.2, grid.425081.a, grid.28171.3d, gr...</td>\n",
       "      <td>Morozov</td>\n",
       "      <td>1</td>\n",
       "      <td>6</td>\n",
       "      <td>False</td>\n",
       "      <td>[0000-0003-3075-7787]</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>7</th>\n",
       "      <td>ur.0767105504.29</td>\n",
       "      <td>7.382478</td>\n",
       "      <td>Irina V</td>\n",
       "      <td>[grid.4886.2, grid.7340.0, grid.5337.2, grid.4...</td>\n",
       "      <td>Grigorieva</td>\n",
       "      <td>1</td>\n",
       "      <td>6</td>\n",
       "      <td>True</td>\n",
       "      <td>[0000-0001-5991-7778]</td>\n",
       "    </tr>\n",
       "  </tbody>\n",
       "</table>\n",
       "</div>"
      ],
      "text/plain": [
       "                   id     score             first_name  \\\n",
       "0  ur.011033016243.08  7.382478              Anatoly A   \n",
       "1   ur.01146544531.57  7.382478                     Da   \n",
       "2  ur.011535264111.51  7.382478               Sergey V   \n",
       "3   ur.01207120103.29  7.382478  Konstantin Sergeevich   \n",
       "4    ur.0657076451.24  7.382478                 Yuanbo   \n",
       "5    ur.0721730631.45  7.382478       Andre Konstantin   \n",
       "6   ur.07423561367.62  7.382478               Sergey V   \n",
       "7    ur.0767105504.29  7.382478                Irina V   \n",
       "\n",
       "                                       research_orgs   last_name  docs_found  \\\n",
       "0  [grid.4886.2, grid.424048.e, grid.425037.7, gr...      Firsov           1   \n",
       "1                                      [grid.5379.8]       Jiang           1   \n",
       "2  [grid.4886.2, grid.5379.8, grid.5254.6, grid.5...     Dubonos           1   \n",
       "3  [grid.5379.8, grid.425037.7, grid.116068.8, gr...   Novoselov           1   \n",
       "4  [grid.8547.e, grid.5386.8, grid.184769.5, grid...       Zhang           1   \n",
       "5  [grid.7340.0, grid.5254.6, grid.418975.6, grid...        Geim           1   \n",
       "6  [grid.4886.2, grid.425081.a, grid.28171.3d, gr...     Morozov           1   \n",
       "7  [grid.4886.2, grid.7340.0, grid.5337.2, grid.4...  Grigorieva           1   \n",
       "\n",
       "   overlap.coauthorship  overlap.organizational               orcid_id  \n",
       "0                     3                    True                    NaN  \n",
       "1                     0                    True                    NaN  \n",
       "2                     0                    True                    NaN  \n",
       "3                   153                    True  [0000-0003-4972-5371]  \n",
       "4                     0                   False                    NaN  \n",
       "5                    38                    True  [0000-0003-2861-8331]  \n",
       "6                     6                   False  [0000-0003-3075-7787]  \n",
       "7                     6                    True  [0000-0001-5991-7778]  "
      ]
     },
     "execution_count": 6,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "overlap_researchers = [\"ur.011535264111.51\", \"ur.011033016243.08\", \"ur.01207120103.29\"]\n",
    "\n",
    "q = f\"\"\"\n",
    "        identify experts \n",
    "            from concepts \"{dsl_escape(some_concepts)}\"\n",
    "            using publications\n",
    "            where research_org_countries is not empty\n",
    "              and year >= 2000\n",
    "        return experts\n",
    "            annotate coauthorship, organizational overlap\n",
    "            with {json.dumps(overlap_researchers)}\n",
    "        \"\"\"\n",
    "\n",
    "print(\"Query:\\n======\", q)\n",
    "\n",
    "dsl.query(q).as_dataframe()\n"
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {
    "Collapsed": "false"
   },
   "source": [
    "### Example 5. Query with MUST/NOT Operators\n",
    "\n",
    "By default, the string containing a list of concepts is interpreted as a sequence of `AND` clauses. That is, the query tries to match the highest number of concepts without any preference. \n",
    "\n",
    "It is possible to specify MUST/NOT rules with concepts by passing them via a string and using the `+` and `-` operators. \n",
    "\n",
    "Note: please remember that concepts phrases (= concepts that are composed by more than one word) need to be wrapped using quotes, and the quotes need to be escaped with a `\\`.\n"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 7,
   "metadata": {
    "Collapsed": "false"
   },
   "outputs": [
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "Query:\n",
      "====== \n",
      "identify experts \n",
      "    from concepts \" \n",
      "    +\\\"ambipolar electric field effect\\\" \n",
      "    -\\\"graphitic films\\\" \n",
      "    +\\\"films\\\"\n",
      "    \\\"electric field effects\\\"\n",
      "    \"\n",
      "    using publications\n",
      "return experts\n",
      "\n"
     ]
    },
    {
     "data": {
      "text/html": [
       "<div>\n",
       "<style scoped>\n",
       "    .dataframe tbody tr th:only-of-type {\n",
       "        vertical-align: middle;\n",
       "    }\n",
       "\n",
       "    .dataframe tbody tr th {\n",
       "        vertical-align: top;\n",
       "    }\n",
       "\n",
       "    .dataframe thead th {\n",
       "        text-align: right;\n",
       "    }\n",
       "</style>\n",
       "<table border=\"1\" class=\"dataframe\">\n",
       "  <thead>\n",
       "    <tr style=\"text-align: right;\">\n",
       "      <th></th>\n",
       "      <th>id</th>\n",
       "      <th>score</th>\n",
       "      <th>research_orgs</th>\n",
       "      <th>last_name</th>\n",
       "      <th>first_name</th>\n",
       "      <th>docs_found</th>\n",
       "      <th>orcid_id</th>\n",
       "    </tr>\n",
       "  </thead>\n",
       "  <tbody>\n",
       "    <tr>\n",
       "      <th>0</th>\n",
       "      <td>ur.01005576245.93</td>\n",
       "      <td>3.480071</td>\n",
       "      <td>[grid.6520.1, grid.121334.6]</td>\n",
       "      <td>Henrard</td>\n",
       "      <td>Luc</td>\n",
       "      <td>1</td>\n",
       "      <td>NaN</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>1</th>\n",
       "      <td>ur.01251242035.86</td>\n",
       "      <td>3.480071</td>\n",
       "      <td>[grid.6520.1, grid.121334.6, grid.12082.39, gr...</td>\n",
       "      <td>Latil</td>\n",
       "      <td>Sylvain</td>\n",
       "      <td>1</td>\n",
       "      <td>NaN</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>2</th>\n",
       "      <td>ur.01000623240.81</td>\n",
       "      <td>2.589067</td>\n",
       "      <td>[grid.164295.d]</td>\n",
       "      <td>Syers</td>\n",
       "      <td>Paul</td>\n",
       "      <td>1</td>\n",
       "      <td>NaN</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>3</th>\n",
       "      <td>ur.01046736440.46</td>\n",
       "      <td>2.589067</td>\n",
       "      <td>[grid.266100.3, grid.410443.6, grid.250008.f, ...</td>\n",
       "      <td>Butch</td>\n",
       "      <td>Nicholas Patrick</td>\n",
       "      <td>1</td>\n",
       "      <td>NaN</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>4</th>\n",
       "      <td>ur.01060352233.12</td>\n",
       "      <td>2.589067</td>\n",
       "      <td>[grid.266100.3, grid.440050.5, grid.410443.6, ...</td>\n",
       "      <td>Paglione</td>\n",
       "      <td>John-Pierre</td>\n",
       "      <td>1</td>\n",
       "      <td>NaN</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>5</th>\n",
       "      <td>ur.01200656557.13</td>\n",
       "      <td>2.589067</td>\n",
       "      <td>[grid.47840.3f, grid.499241.3, grid.184769.5, ...</td>\n",
       "      <td>Fuhrer</td>\n",
       "      <td>Michael Sears</td>\n",
       "      <td>1</td>\n",
       "      <td>[0000-0001-6183-2773]</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>6</th>\n",
       "      <td>ur.01205352017.54</td>\n",
       "      <td>2.589067</td>\n",
       "      <td>[grid.31501.36, grid.164295.d, grid.35541.36, ...</td>\n",
       "      <td>Kim</td>\n",
       "      <td>Dohun</td>\n",
       "      <td>1</td>\n",
       "      <td>[0000-0001-9687-2089]</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>7</th>\n",
       "      <td>ur.01025667341.62</td>\n",
       "      <td>2.061342</td>\n",
       "      <td>[grid.263856.c, grid.78837.33, grid.35043.31, ...</td>\n",
       "      <td>Sysoev</td>\n",
       "      <td>Victor V</td>\n",
       "      <td>1</td>\n",
       "      <td>[0000-0002-0372-1802]</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>8</th>\n",
       "      <td>ur.01245543252.06</td>\n",
       "      <td>2.061342</td>\n",
       "      <td>[grid.14476.30, grid.24434.35]</td>\n",
       "      <td>Shekhirev</td>\n",
       "      <td>Mikhail A</td>\n",
       "      <td>1</td>\n",
       "      <td>[0000-0002-8381-1276]</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>9</th>\n",
       "      <td>ur.01276657166.76</td>\n",
       "      <td>2.061342</td>\n",
       "      <td>[grid.426324.5, grid.10420.37, grid.24434.35, ...</td>\n",
       "      <td>Lipatov</td>\n",
       "      <td>Alexey</td>\n",
       "      <td>1</td>\n",
       "      <td>[0000-0001-5043-1616]</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>10</th>\n",
       "      <td>ur.013212454037.49</td>\n",
       "      <td>2.061342</td>\n",
       "      <td>[grid.78837.33]</td>\n",
       "      <td>Lashkov</td>\n",
       "      <td>Andrey V</td>\n",
       "      <td>1</td>\n",
       "      <td>[0000-0001-6794-8523]</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>11</th>\n",
       "      <td>ur.016560200577.43</td>\n",
       "      <td>2.061342</td>\n",
       "      <td>[grid.24434.35]</td>\n",
       "      <td>Vorobeva</td>\n",
       "      <td>Nataliia S</td>\n",
       "      <td>1</td>\n",
       "      <td>NaN</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>12</th>\n",
       "      <td>ur.0646414360.09</td>\n",
       "      <td>2.061342</td>\n",
       "      <td>[grid.35043.31, grid.24434.35, grid.170430.1, ...</td>\n",
       "      <td>Sinitskii</td>\n",
       "      <td>Alexander S</td>\n",
       "      <td>1</td>\n",
       "      <td>[0000-0002-8688-3451]</td>\n",
       "    </tr>\n",
       "  </tbody>\n",
       "</table>\n",
       "</div>"
      ],
      "text/plain": [
       "                    id     score  \\\n",
       "0    ur.01005576245.93  3.480071   \n",
       "1    ur.01251242035.86  3.480071   \n",
       "2    ur.01000623240.81  2.589067   \n",
       "3    ur.01046736440.46  2.589067   \n",
       "4    ur.01060352233.12  2.589067   \n",
       "5    ur.01200656557.13  2.589067   \n",
       "6    ur.01205352017.54  2.589067   \n",
       "7    ur.01025667341.62  2.061342   \n",
       "8    ur.01245543252.06  2.061342   \n",
       "9    ur.01276657166.76  2.061342   \n",
       "10  ur.013212454037.49  2.061342   \n",
       "11  ur.016560200577.43  2.061342   \n",
       "12    ur.0646414360.09  2.061342   \n",
       "\n",
       "                                        research_orgs  last_name  \\\n",
       "0                        [grid.6520.1, grid.121334.6]    Henrard   \n",
       "1   [grid.6520.1, grid.121334.6, grid.12082.39, gr...      Latil   \n",
       "2                                     [grid.164295.d]      Syers   \n",
       "3   [grid.266100.3, grid.410443.6, grid.250008.f, ...      Butch   \n",
       "4   [grid.266100.3, grid.440050.5, grid.410443.6, ...   Paglione   \n",
       "5   [grid.47840.3f, grid.499241.3, grid.184769.5, ...     Fuhrer   \n",
       "6   [grid.31501.36, grid.164295.d, grid.35541.36, ...        Kim   \n",
       "7   [grid.263856.c, grid.78837.33, grid.35043.31, ...     Sysoev   \n",
       "8                      [grid.14476.30, grid.24434.35]  Shekhirev   \n",
       "9   [grid.426324.5, grid.10420.37, grid.24434.35, ...    Lipatov   \n",
       "10                                    [grid.78837.33]    Lashkov   \n",
       "11                                    [grid.24434.35]   Vorobeva   \n",
       "12  [grid.35043.31, grid.24434.35, grid.170430.1, ...  Sinitskii   \n",
       "\n",
       "          first_name  docs_found               orcid_id  \n",
       "0                Luc           1                    NaN  \n",
       "1            Sylvain           1                    NaN  \n",
       "2               Paul           1                    NaN  \n",
       "3   Nicholas Patrick           1                    NaN  \n",
       "4        John-Pierre           1                    NaN  \n",
       "5      Michael Sears           1  [0000-0001-6183-2773]  \n",
       "6              Dohun           1  [0000-0001-9687-2089]  \n",
       "7           Victor V           1  [0000-0002-0372-1802]  \n",
       "8          Mikhail A           1  [0000-0002-8381-1276]  \n",
       "9             Alexey           1  [0000-0001-5043-1616]  \n",
       "10          Andrey V           1  [0000-0001-6794-8523]  \n",
       "11        Nataliia S           1                    NaN  \n",
       "12       Alexander S           1  [0000-0002-8688-3451]  "
      ]
     },
     "execution_count": 7,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "concepts = \"\"\" \n",
    "    +\"ambipolar electric field effect\" \n",
    "    -\"graphitic films\" \n",
    "    +\"films\"\n",
    "    \"electric field effects\"\n",
    "    \"\"\"\n",
    "\n",
    "q = f\"\"\"\n",
    "identify experts \n",
    "    from concepts \"{dsl_escape(concepts)}\"\n",
    "    using publications\n",
    "return experts\n",
    "\"\"\"\n",
    "\n",
    "print(\"Query:\\n======\", q)\n",
    "\n",
    "dsl.query(q).as_dataframe()\n",
    "\n"
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {
    "Collapsed": "false"
   },
   "source": [
    "### Example 6. MUST together with AND/OR "
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 8,
   "metadata": {
    "Collapsed": "false"
   },
   "outputs": [
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "Query:\n",
      "====== \n",
      "identify experts \n",
      "    from concepts \" \n",
      "    (+\\\"ambipolar electric field effect\\\" -\\\"graphitic films\\\") OR \n",
      "    (+\\\"films\\\" -\\\"electric field effects\\\")\n",
      "    \"\n",
      "    using publications\n",
      "return experts\n",
      "\n"
     ]
    },
    {
     "data": {
      "text/html": [
       "<div>\n",
       "<style scoped>\n",
       "    .dataframe tbody tr th:only-of-type {\n",
       "        vertical-align: middle;\n",
       "    }\n",
       "\n",
       "    .dataframe tbody tr th {\n",
       "        vertical-align: top;\n",
       "    }\n",
       "\n",
       "    .dataframe thead th {\n",
       "        text-align: right;\n",
       "    }\n",
       "</style>\n",
       "<table border=\"1\" class=\"dataframe\">\n",
       "  <thead>\n",
       "    <tr style=\"text-align: right;\">\n",
       "      <th></th>\n",
       "      <th>id</th>\n",
       "      <th>score</th>\n",
       "      <th>first_name</th>\n",
       "      <th>research_orgs</th>\n",
       "      <th>last_name</th>\n",
       "      <th>docs_found</th>\n",
       "      <th>orcid_id</th>\n",
       "    </tr>\n",
       "  </thead>\n",
       "  <tbody>\n",
       "    <tr>\n",
       "      <th>0</th>\n",
       "      <td>ur.014516430466.88</td>\n",
       "      <td>10.359314</td>\n",
       "      <td>Ledford C</td>\n",
       "      <td>[grid.411377.7]</td>\n",
       "      <td>Carter</td>\n",
       "      <td>18</td>\n",
       "      <td>NaN</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>1</th>\n",
       "      <td>ur.01034030721.03</td>\n",
       "      <td>3.576317</td>\n",
       "      <td>Pablo</td>\n",
       "      <td>[grid.5338.d, grid.116068.8, grid.21941.3f, gr...</td>\n",
       "      <td>Jarillo-Herrero</td>\n",
       "      <td>3</td>\n",
       "      <td>[0000-0001-8217-8213]</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>2</th>\n",
       "      <td>ur.010122277451.23</td>\n",
       "      <td>3.499347</td>\n",
       "      <td>Alberta</td>\n",
       "      <td>NaN</td>\n",
       "      <td>Meyer</td>\n",
       "      <td>4</td>\n",
       "      <td>NaN</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>3</th>\n",
       "      <td>ur.012760700525.87</td>\n",
       "      <td>3.499347</td>\n",
       "      <td>Esther</td>\n",
       "      <td>NaN</td>\n",
       "      <td>Aschemeyer</td>\n",
       "      <td>4</td>\n",
       "      <td>NaN</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>4</th>\n",
       "      <td>ur.011313310557.79</td>\n",
       "      <td>2.884011</td>\n",
       "      <td>Erwin Randolph</td>\n",
       "      <td>[grid.26009.3d]</td>\n",
       "      <td>Parson</td>\n",
       "      <td>5</td>\n",
       "      <td>NaN</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>5</th>\n",
       "      <td>ur.011224625507.86</td>\n",
       "      <td>2.798074</td>\n",
       "      <td>W</td>\n",
       "      <td>[grid.461804.f]</td>\n",
       "      <td>Feneberg</td>\n",
       "      <td>1</td>\n",
       "      <td>NaN</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>6</th>\n",
       "      <td>ur.015134442047.63</td>\n",
       "      <td>2.798074</td>\n",
       "      <td>Manfred A</td>\n",
       "      <td>[grid.16463.36]</td>\n",
       "      <td>Hellberg</td>\n",
       "      <td>1</td>\n",
       "      <td>[0000-0003-0785-8125]</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>7</th>\n",
       "      <td>ur.01150036175.42</td>\n",
       "      <td>2.434489</td>\n",
       "      <td>Peng</td>\n",
       "      <td>[grid.59025.3b]</td>\n",
       "      <td>Ren</td>\n",
       "      <td>2</td>\n",
       "      <td>NaN</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>8</th>\n",
       "      <td>ur.013275477227.26</td>\n",
       "      <td>2.434489</td>\n",
       "      <td>Lan</td>\n",
       "      <td>[grid.17635.36, grid.59025.3b, grid.451303.0, ...</td>\n",
       "      <td>Wang</td>\n",
       "      <td>2</td>\n",
       "      <td>[0000-0001-7124-2718]</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>9</th>\n",
       "      <td>ur.056250446.77</td>\n",
       "      <td>2.434489</td>\n",
       "      <td>Azat</td>\n",
       "      <td>[grid.59025.3b]</td>\n",
       "      <td>Sulaev</td>\n",
       "      <td>2</td>\n",
       "      <td>NaN</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>10</th>\n",
       "      <td>ur.0624630056.98</td>\n",
       "      <td>2.434489</td>\n",
       "      <td>Shun-Qing</td>\n",
       "      <td>[grid.8547.e, grid.450298.2, grid.194645.b, gr...</td>\n",
       "      <td>Shen</td>\n",
       "      <td>2</td>\n",
       "      <td>NaN</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>11</th>\n",
       "      <td>ur.0756673070.05</td>\n",
       "      <td>2.434489</td>\n",
       "      <td>Bin</td>\n",
       "      <td>[grid.59025.3b]</td>\n",
       "      <td>Xia</td>\n",
       "      <td>2</td>\n",
       "      <td>NaN</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>12</th>\n",
       "      <td>ur.01003543541.78</td>\n",
       "      <td>2.370124</td>\n",
       "      <td>Shlomo</td>\n",
       "      <td>[grid.12136.37, grid.13992.30, grid.133342.4, ...</td>\n",
       "      <td>Efrima</td>\n",
       "      <td>3</td>\n",
       "      <td>NaN</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>13</th>\n",
       "      <td>ur.015146652071.00</td>\n",
       "      <td>2.370124</td>\n",
       "      <td>D</td>\n",
       "      <td>[grid.13992.30, grid.7489.2]</td>\n",
       "      <td>Yogev</td>\n",
       "      <td>3</td>\n",
       "      <td>NaN</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>14</th>\n",
       "      <td>ur.012476642650.51</td>\n",
       "      <td>2.251025</td>\n",
       "      <td>B Ruby</td>\n",
       "      <td>[grid.205975.c]</td>\n",
       "      <td>Rich</td>\n",
       "      <td>3</td>\n",
       "      <td>NaN</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>15</th>\n",
       "      <td>ur.01022425321.95</td>\n",
       "      <td>2.067556</td>\n",
       "      <td>Andrey A</td>\n",
       "      <td>[grid.35043.31, grid.7491.b, grid.4764.1, grid...</td>\n",
       "      <td>Turchanin</td>\n",
       "      <td>2</td>\n",
       "      <td>[0000-0003-2388-1042]</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>16</th>\n",
       "      <td>ur.01161437031.05</td>\n",
       "      <td>2.067556</td>\n",
       "      <td>Joachim</td>\n",
       "      <td>[grid.5719.a, grid.419534.e, grid.4372.2, grid...</td>\n",
       "      <td>Mayer</td>\n",
       "      <td>2</td>\n",
       "      <td>[0000-0003-3292-5342]</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>17</th>\n",
       "      <td>ur.01163755245.41</td>\n",
       "      <td>2.067556</td>\n",
       "      <td>Konstantin B</td>\n",
       "      <td>[grid.4886.2, grid.457334.2, grid.411233.6, gr...</td>\n",
       "      <td>Efetov</td>\n",
       "      <td>2</td>\n",
       "      <td>[0000-0003-2245-1366]</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>18</th>\n",
       "      <td>ur.01172120354.34</td>\n",
       "      <td>2.067556</td>\n",
       "      <td>Armin</td>\n",
       "      <td>[grid.7491.b, grid.7700.0, grid.414703.5, grid...</td>\n",
       "      <td>Glzhuser</td>\n",
       "      <td>2</td>\n",
       "      <td>[0000-0002-0838-9028]</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>19</th>\n",
       "      <td>ur.0704114136.03</td>\n",
       "      <td>2.067556</td>\n",
       "      <td>Thomas</td>\n",
       "      <td>[grid.10392.39, grid.4764.1, grid.7491.b]</td>\n",
       "      <td>Weimann</td>\n",
       "      <td>2</td>\n",
       "      <td>NaN</td>\n",
       "    </tr>\n",
       "  </tbody>\n",
       "</table>\n",
       "</div>"
      ],
      "text/plain": [
       "                    id      score      first_name  \\\n",
       "0   ur.014516430466.88  10.359314       Ledford C   \n",
       "1    ur.01034030721.03   3.576317           Pablo   \n",
       "2   ur.010122277451.23   3.499347         Alberta   \n",
       "3   ur.012760700525.87   3.499347          Esther   \n",
       "4   ur.011313310557.79   2.884011  Erwin Randolph   \n",
       "5   ur.011224625507.86   2.798074               W   \n",
       "6   ur.015134442047.63   2.798074       Manfred A   \n",
       "7    ur.01150036175.42   2.434489            Peng   \n",
       "8   ur.013275477227.26   2.434489             Lan   \n",
       "9      ur.056250446.77   2.434489            Azat   \n",
       "10    ur.0624630056.98   2.434489       Shun-Qing   \n",
       "11    ur.0756673070.05   2.434489             Bin   \n",
       "12   ur.01003543541.78   2.370124          Shlomo   \n",
       "13  ur.015146652071.00   2.370124               D   \n",
       "14  ur.012476642650.51   2.251025          B Ruby   \n",
       "15   ur.01022425321.95   2.067556        Andrey A   \n",
       "16   ur.01161437031.05   2.067556         Joachim   \n",
       "17   ur.01163755245.41   2.067556    Konstantin B   \n",
       "18   ur.01172120354.34   2.067556           Armin   \n",
       "19    ur.0704114136.03   2.067556          Thomas   \n",
       "\n",
       "                                        research_orgs        last_name  \\\n",
       "0                                     [grid.411377.7]           Carter   \n",
       "1   [grid.5338.d, grid.116068.8, grid.21941.3f, gr...  Jarillo-Herrero   \n",
       "2                                                 NaN            Meyer   \n",
       "3                                                 NaN       Aschemeyer   \n",
       "4                                     [grid.26009.3d]           Parson   \n",
       "5                                     [grid.461804.f]         Feneberg   \n",
       "6                                     [grid.16463.36]         Hellberg   \n",
       "7                                     [grid.59025.3b]              Ren   \n",
       "8   [grid.17635.36, grid.59025.3b, grid.451303.0, ...             Wang   \n",
       "9                                     [grid.59025.3b]           Sulaev   \n",
       "10  [grid.8547.e, grid.450298.2, grid.194645.b, gr...             Shen   \n",
       "11                                    [grid.59025.3b]              Xia   \n",
       "12  [grid.12136.37, grid.13992.30, grid.133342.4, ...           Efrima   \n",
       "13                       [grid.13992.30, grid.7489.2]            Yogev   \n",
       "14                                    [grid.205975.c]             Rich   \n",
       "15  [grid.35043.31, grid.7491.b, grid.4764.1, grid...        Turchanin   \n",
       "16  [grid.5719.a, grid.419534.e, grid.4372.2, grid...            Mayer   \n",
       "17  [grid.4886.2, grid.457334.2, grid.411233.6, gr...           Efetov   \n",
       "18  [grid.7491.b, grid.7700.0, grid.414703.5, grid...       Glzhuser   \n",
       "19          [grid.10392.39, grid.4764.1, grid.7491.b]          Weimann   \n",
       "\n",
       "    docs_found               orcid_id  \n",
       "0           18                    NaN  \n",
       "1            3  [0000-0001-8217-8213]  \n",
       "2            4                    NaN  \n",
       "3            4                    NaN  \n",
       "4            5                    NaN  \n",
       "5            1                    NaN  \n",
       "6            1  [0000-0003-0785-8125]  \n",
       "7            2                    NaN  \n",
       "8            2  [0000-0001-7124-2718]  \n",
       "9            2                    NaN  \n",
       "10           2                    NaN  \n",
       "11           2                    NaN  \n",
       "12           3                    NaN  \n",
       "13           3                    NaN  \n",
       "14           3                    NaN  \n",
       "15           2  [0000-0003-2388-1042]  \n",
       "16           2  [0000-0003-3292-5342]  \n",
       "17           2  [0000-0003-2245-1366]  \n",
       "18           2  [0000-0002-0838-9028]  \n",
       "19           2                    NaN  "
      ]
     },
     "execution_count": 8,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "concepts = \"\"\" \n",
    "    (+\"ambipolar electric field effect\" -\"graphitic films\") OR \n",
    "    (+\"films\" -\"electric field effects\")\n",
    "    \"\"\"\n",
    "\n",
    "q = f\"\"\"\n",
    "identify experts \n",
    "    from concepts \"{dsl_escape(concepts)}\"\n",
    "    using publications\n",
    "return experts\n",
    "\"\"\"\n",
    "\n",
    "print(\"Query:\\n======\", q)\n",
    "\n",
    "dsl.query(q).as_dataframe()\n",
    "\n"
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {
    "Collapsed": "false"
   },
   "source": [
    "### Example 7. Wildcard searches"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 9,
   "metadata": {
    "Collapsed": "false"
   },
   "outputs": [
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "Query:\n",
      "====== \n",
      "identify experts \n",
      "    from concepts \"temperat* \\\"ray diffraction\\\" -magnet* \"\n",
      "    using publications\n",
      "return experts\n",
      "\n"
     ]
    },
    {
     "data": {
      "text/html": [
       "<div>\n",
       "<style scoped>\n",
       "    .dataframe tbody tr th:only-of-type {\n",
       "        vertical-align: middle;\n",
       "    }\n",
       "\n",
       "    .dataframe tbody tr th {\n",
       "        vertical-align: top;\n",
       "    }\n",
       "\n",
       "    .dataframe thead th {\n",
       "        text-align: right;\n",
       "    }\n",
       "</style>\n",
       "<table border=\"1\" class=\"dataframe\">\n",
       "  <thead>\n",
       "    <tr style=\"text-align: right;\">\n",
       "      <th></th>\n",
       "      <th>id</th>\n",
       "      <th>score</th>\n",
       "      <th>research_orgs</th>\n",
       "      <th>last_name</th>\n",
       "      <th>first_name</th>\n",
       "      <th>docs_found</th>\n",
       "      <th>orcid_id</th>\n",
       "    </tr>\n",
       "  </thead>\n",
       "  <tbody>\n",
       "    <tr>\n",
       "      <th>0</th>\n",
       "      <td>ur.010752560241.92</td>\n",
       "      <td>9.023557</td>\n",
       "      <td>[grid.494717.8, grid.411717.5, grid.5399.6, gr...</td>\n",
       "      <td>Buscail</td>\n",
       "      <td>Henri</td>\n",
       "      <td>4</td>\n",
       "      <td>NaN</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>1</th>\n",
       "      <td>ur.016151106345.71</td>\n",
       "      <td>8.850567</td>\n",
       "      <td>[grid.461616.2]</td>\n",
       "      <td>Kolarik</td>\n",
       "      <td>Vladislav</td>\n",
       "      <td>4</td>\n",
       "      <td>NaN</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>2</th>\n",
       "      <td>ur.012006337013.67</td>\n",
       "      <td>8.245036</td>\n",
       "      <td>[grid.461616.2]</td>\n",
       "      <td>Engel</td>\n",
       "      <td>Walter</td>\n",
       "      <td>4</td>\n",
       "      <td>NaN</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>3</th>\n",
       "      <td>ur.01264404625.74</td>\n",
       "      <td>8.127706</td>\n",
       "      <td>[grid.425759.8, grid.415877.8, grid.465435.5, ...</td>\n",
       "      <td>Boldyreva</td>\n",
       "      <td>Elena V</td>\n",
       "      <td>4</td>\n",
       "      <td>[0000-0002-1401-2438]</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>4</th>\n",
       "      <td>ur.01356350415.50</td>\n",
       "      <td>8.127706</td>\n",
       "      <td>[grid.415877.8, grid.4605.7, grid.418421.a, gr...</td>\n",
       "      <td>Zakharov</td>\n",
       "      <td>Boris A</td>\n",
       "      <td>4</td>\n",
       "      <td>[0000-0002-3520-632X]</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>5</th>\n",
       "      <td>ur.07650346631.13</td>\n",
       "      <td>7.050485</td>\n",
       "      <td>[grid.4444.0, grid.462844.8, grid.424133.3, gr...</td>\n",
       "      <td>Iti</td>\n",
       "      <td>Jean-Paul</td>\n",
       "      <td>3</td>\n",
       "      <td>NaN</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>6</th>\n",
       "      <td>ur.011274203435.25</td>\n",
       "      <td>6.858861</td>\n",
       "      <td>[grid.27736.37, grid.418094.0]</td>\n",
       "      <td>Kocharyan</td>\n",
       "      <td>Vahan</td>\n",
       "      <td>3</td>\n",
       "      <td>NaN</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>7</th>\n",
       "      <td>ur.015270341551.59</td>\n",
       "      <td>6.810949</td>\n",
       "      <td>[grid.494717.8, grid.5399.6]</td>\n",
       "      <td>Caudron</td>\n",
       "      <td>Eric</td>\n",
       "      <td>3</td>\n",
       "      <td>NaN</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>8</th>\n",
       "      <td>ur.012153454351.77</td>\n",
       "      <td>6.641345</td>\n",
       "      <td>[grid.461616.2, grid.466709.a]</td>\n",
       "      <td>Juez-Lorenzo</td>\n",
       "      <td>Maria Del Mar</td>\n",
       "      <td>3</td>\n",
       "      <td>NaN</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>9</th>\n",
       "      <td>ur.011235502761.97</td>\n",
       "      <td>6.217678</td>\n",
       "      <td>NaN</td>\n",
       "      <td>Trivio</td>\n",
       "      <td>F</td>\n",
       "      <td>3</td>\n",
       "      <td>NaN</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>10</th>\n",
       "      <td>ur.012267521017.15</td>\n",
       "      <td>6.217678</td>\n",
       "      <td>NaN</td>\n",
       "      <td>Vzquez</td>\n",
       "      <td>T</td>\n",
       "      <td>3</td>\n",
       "      <td>NaN</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>11</th>\n",
       "      <td>ur.012630443761.25</td>\n",
       "      <td>6.217678</td>\n",
       "      <td>NaN</td>\n",
       "      <td>Ruiz De Gauna</td>\n",
       "      <td>A</td>\n",
       "      <td>3</td>\n",
       "      <td>NaN</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>12</th>\n",
       "      <td>ur.012352473245.95</td>\n",
       "      <td>6.180346</td>\n",
       "      <td>[grid.47894.36, grid.168010.e, grid.299175.1, ...</td>\n",
       "      <td>Qadri</td>\n",
       "      <td>Syed B</td>\n",
       "      <td>3</td>\n",
       "      <td>NaN</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>13</th>\n",
       "      <td>ur.013352205311.74</td>\n",
       "      <td>6.088813</td>\n",
       "      <td>[grid.412761.7]</td>\n",
       "      <td>Ustinova</td>\n",
       "      <td>I S</td>\n",
       "      <td>3</td>\n",
       "      <td>NaN</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>14</th>\n",
       "      <td>ur.0654202176.07</td>\n",
       "      <td>6.088813</td>\n",
       "      <td>[grid.4886.2, grid.465372.1]</td>\n",
       "      <td>Kadyrova</td>\n",
       "      <td>Nadezda I</td>\n",
       "      <td>3</td>\n",
       "      <td>NaN</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>15</th>\n",
       "      <td>ur.012077537127.36</td>\n",
       "      <td>6.035814</td>\n",
       "      <td>[grid.461616.2, grid.4561.6, grid.4886.2]</td>\n",
       "      <td>Eisenreich</td>\n",
       "      <td>Norbert</td>\n",
       "      <td>3</td>\n",
       "      <td>NaN</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>16</th>\n",
       "      <td>ur.01015306115.93</td>\n",
       "      <td>5.794733</td>\n",
       "      <td>[grid.418421.a, grid.4605.7, grid.435414.3]</td>\n",
       "      <td>Losev</td>\n",
       "      <td>Evgeniy A</td>\n",
       "      <td>3</td>\n",
       "      <td>[0000-0003-1743-4166]</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>17</th>\n",
       "      <td>ur.014146743075.39</td>\n",
       "      <td>5.561709</td>\n",
       "      <td>[grid.4795.f, grid.463879.7, grid.411840.8, gr...</td>\n",
       "      <td>Hagenmuller</td>\n",
       "      <td>Paul</td>\n",
       "      <td>3</td>\n",
       "      <td>NaN</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>18</th>\n",
       "      <td>ur.015400602443.87</td>\n",
       "      <td>5.309069</td>\n",
       "      <td>[grid.423902.e, grid.435347.2]</td>\n",
       "      <td>Guseinov</td>\n",
       "      <td>G G</td>\n",
       "      <td>3</td>\n",
       "      <td>NaN</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>19</th>\n",
       "      <td>ur.012651704451.05</td>\n",
       "      <td>5.108303</td>\n",
       "      <td>[grid.32197.3e, grid.136593.b]</td>\n",
       "      <td>Oguni</td>\n",
       "      <td>Masaharu</td>\n",
       "      <td>2</td>\n",
       "      <td>NaN</td>\n",
       "    </tr>\n",
       "  </tbody>\n",
       "</table>\n",
       "</div>"
      ],
      "text/plain": [
       "                    id     score  \\\n",
       "0   ur.010752560241.92  9.023557   \n",
       "1   ur.016151106345.71  8.850567   \n",
       "2   ur.012006337013.67  8.245036   \n",
       "3    ur.01264404625.74  8.127706   \n",
       "4    ur.01356350415.50  8.127706   \n",
       "5    ur.07650346631.13  7.050485   \n",
       "6   ur.011274203435.25  6.858861   \n",
       "7   ur.015270341551.59  6.810949   \n",
       "8   ur.012153454351.77  6.641345   \n",
       "9   ur.011235502761.97  6.217678   \n",
       "10  ur.012267521017.15  6.217678   \n",
       "11  ur.012630443761.25  6.217678   \n",
       "12  ur.012352473245.95  6.180346   \n",
       "13  ur.013352205311.74  6.088813   \n",
       "14    ur.0654202176.07  6.088813   \n",
       "15  ur.012077537127.36  6.035814   \n",
       "16   ur.01015306115.93  5.794733   \n",
       "17  ur.014146743075.39  5.561709   \n",
       "18  ur.015400602443.87  5.309069   \n",
       "19  ur.012651704451.05  5.108303   \n",
       "\n",
       "                                        research_orgs      last_name  \\\n",
       "0   [grid.494717.8, grid.411717.5, grid.5399.6, gr...        Buscail   \n",
       "1                                     [grid.461616.2]        Kolarik   \n",
       "2                                     [grid.461616.2]          Engel   \n",
       "3   [grid.425759.8, grid.415877.8, grid.465435.5, ...      Boldyreva   \n",
       "4   [grid.415877.8, grid.4605.7, grid.418421.a, gr...       Zakharov   \n",
       "5   [grid.4444.0, grid.462844.8, grid.424133.3, gr...           Iti   \n",
       "6                      [grid.27736.37, grid.418094.0]      Kocharyan   \n",
       "7                        [grid.494717.8, grid.5399.6]        Caudron   \n",
       "8                      [grid.461616.2, grid.466709.a]   Juez-Lorenzo   \n",
       "9                                                 NaN        Trivio   \n",
       "10                                                NaN        Vzquez   \n",
       "11                                                NaN  Ruiz De Gauna   \n",
       "12  [grid.47894.36, grid.168010.e, grid.299175.1, ...          Qadri   \n",
       "13                                    [grid.412761.7]       Ustinova   \n",
       "14                       [grid.4886.2, grid.465372.1]       Kadyrova   \n",
       "15          [grid.461616.2, grid.4561.6, grid.4886.2]     Eisenreich   \n",
       "16        [grid.418421.a, grid.4605.7, grid.435414.3]          Losev   \n",
       "17  [grid.4795.f, grid.463879.7, grid.411840.8, gr...    Hagenmuller   \n",
       "18                     [grid.423902.e, grid.435347.2]       Guseinov   \n",
       "19                     [grid.32197.3e, grid.136593.b]          Oguni   \n",
       "\n",
       "       first_name  docs_found               orcid_id  \n",
       "0           Henri           4                    NaN  \n",
       "1       Vladislav           4                    NaN  \n",
       "2          Walter           4                    NaN  \n",
       "3         Elena V           4  [0000-0002-1401-2438]  \n",
       "4         Boris A           4  [0000-0002-3520-632X]  \n",
       "5       Jean-Paul           3                    NaN  \n",
       "6           Vahan           3                    NaN  \n",
       "7            Eric           3                    NaN  \n",
       "8   Maria Del Mar           3                    NaN  \n",
       "9               F           3                    NaN  \n",
       "10              T           3                    NaN  \n",
       "11              A           3                    NaN  \n",
       "12         Syed B           3                    NaN  \n",
       "13            I S           3                    NaN  \n",
       "14      Nadezda I           3                    NaN  \n",
       "15        Norbert           3                    NaN  \n",
       "16      Evgeniy A           3  [0000-0003-1743-4166]  \n",
       "17           Paul           3                    NaN  \n",
       "18            G G           3                    NaN  \n",
       "19       Masaharu           2                    NaN  "
      ]
     },
     "execution_count": 9,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "concepts = \"\"\"temperat* \"ray diffraction\" -magnet* \"\"\"\n",
    "\n",
    "q = f\"\"\"\n",
    "identify experts \n",
    "    from concepts \"{dsl_escape(concepts)}\"\n",
    "    using publications\n",
    "return experts\n",
    "\"\"\"\n",
    "\n",
    "print(\"Query:\\n======\", q)\n",
    "\n",
    "dsl.query(q).as_dataframe()"
   ]
  }
 ],
 "metadata": {
  "kernel_info": {
   "name": "dimcli_env"
  },
  "kernelspec": {
   "display_name": "Python 3",
   "language": "python",
   "name": "python3"
  },
  "language_info": {
   "codemirror_mode": {
    "name": "ipython",
    "version": 3
   },
   "file_extension": ".py",
   "mimetype": "text/x-python",
   "name": "python",
   "nbconvert_exporter": "python",
   "pygments_lexer": "ipython3",
   "version": "3.8.5"
  },
  "nteract": {
   "version": "0.14.5"
  },
  "toc-autonumbering": false,
  "toc-showcode": false,
  "toc-showmarkdowntxt": true,
  "toc-showtags": false
 },
 "nbformat": 4,
 "nbformat_minor": 4
}
